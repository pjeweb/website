(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{11:function(t,e,s){"use strict";s.d(e,"b",(function(){return h})),s.d(e,"c",(function(){return c})),s.d(e,"d",(function(){return u})),s.d(e,"e",(function(){return l})),s.d(e,"f",(function(){return d})),s.d(e,"a",(function(){return m}));var i=s(0),n=s.n(i),o=s(3);const a="(?:"+[...s(122)].join("|")+")",r=document.createElement("div");class u{format(t,e){return r.textContent=e,r.innerHTML}}class h{format(t,e,s=null){let i=s&&s.user&&s.user.hasFeature(o.a.TWITCHSUB)||!s||!s.user?t.emoteRegexTwitch:t.emoteRegexNormal;return null!=i?e.replace(i,'$1<div title="$2" class="emote $2">$2 </div>'):e}}class c{format(t,e,s=null){return s.user&&0===e.indexOf("&gt;")&&s.user.hasAnyFeatures(o.a.SUBSCRIBER)&&(e=`<span class="greentext">${e}</span>`),e}}class l{format(t,e,s=null){return s&&s.mentioned&&s.mentioned.length>0?e.replace(new RegExp(`((?:^|\\s)@?)(${s.mentioned.join("|")})(?=$|\\s|[.?!,])`,"igm"),'$1<span class="chat-user">$2</span>'):e}}class d{constructor(){const t="\\u0024\\u00A2-\\u00A5\\u058F\\u060B\\u09F2\\u09F3\\u09FB\\u0AF1\\u0BF9\\u0E3F\\u17DB\\u20A0-\\u20B9\\uA838\\uFDFC\\uFE69\\uFF04\\uFFE0\\uFFE1\\uFFE5\\uFFE6",e="\\u0041-\\u005A\\u0061-\\u007A\\u00AA\\u00B5\\u00BA\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u0527\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0\\u08A2-\\u08AC\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0977\\u0979-\\u097F\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C33\\u0C35-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191C\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2183\\u2184\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005\\u3006\\u3031-\\u3035\\u303B\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA697\\uA6A0-\\uA6E5\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA793\\uA7A0-\\uA7AA\\uA7F8-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA80-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC"+"\\u0030-\\u0039\\u00B2\\u00B3\\u00B9\\u00BC-\\u00BE\\u0660-\\u0669\\u06F0-\\u06F9\\u07C0-\\u07C9\\u0966-\\u096F\\u09E6-\\u09EF\\u09F4-\\u09F9\\u0A66-\\u0A6F\\u0AE6-\\u0AEF\\u0B66-\\u0B6F\\u0B72-\\u0B77\\u0BE6-\\u0BF2\\u0C66-\\u0C6F\\u0C78-\\u0C7E\\u0CE6-\\u0CEF\\u0D66-\\u0D75\\u0E50-\\u0E59\\u0ED0-\\u0ED9\\u0F20-\\u0F33\\u1040-\\u1049\\u1090-\\u1099\\u1369-\\u137C\\u16EE-\\u16F0\\u17E0-\\u17E9\\u17F0-\\u17F9\\u1810-\\u1819\\u1946-\\u194F\\u19D0-\\u19DA\\u1A80-\\u1A89\\u1A90-\\u1A99\\u1B50-\\u1B59\\u1BB0-\\u1BB9\\u1C40-\\u1C49\\u1C50-\\u1C59\\u2070\\u2074-\\u2079\\u2080-\\u2089\\u2150-\\u2182\\u2185-\\u2189\\u2460-\\u249B\\u24EA-\\u24FF\\u2776-\\u2793\\u2CFD\\u3007\\u3021-\\u3029\\u3038-\\u303A\\u3192-\\u3195\\u3220-\\u3229\\u3248-\\u324F\\u3251-\\u325F\\u3280-\\u3289\\u32B1-\\u32BF\\uA620-\\uA629\\uA6E6-\\uA6EF\\uA830-\\uA835\\uA8D0-\\uA8D9\\uA900-\\uA909\\uA9D0-\\uA9D9\\uAA50-\\uAA59\\uABF0-\\uABF9\\uFF10-\\uFF19",s=e+"/\\-+=_&~*%@|#.,:;'?!"+t+"\\u005E\\u0060\\u00A8\\u00AF\\u00B4\\u00B8\\u02C2-\\u02C5\\u02D2-\\u02DF\\u02E5-\\u02EB\\u02ED\\u02EF-\\u02FF\\u0375\\u0384\\u0385\\u1FBD\\u1FBF-\\u1FC1\\u1FCD-\\u1FCF\\u1FDD-\\u1FDF\\u1FED-\\u1FEF\\u1FFD\\u1FFE\\u309B\\u309C\\uA700-\\uA716\\uA720\\uA721\\uA789\\uA78A\\uFBB2-\\uFBC1\\uFF3E\\uFF40\\uFFE3"+"\\u00A6\\u00A9\\u00AE\\u00B0\\u0482\\u060E\\u060F\\u06DE\\u06E9\\u06FD\\u06FE\\u07F6\\u09FA\\u0B70\\u0BF3-\\u0BF8\\u0BFA\\u0C7F\\u0D79\\u0F01-\\u0F03\\u0F13\\u0F15-\\u0F17\\u0F1A-\\u0F1F\\u0F34\\u0F36\\u0F38\\u0FBE-\\u0FC5\\u0FC7-\\u0FCC\\u0FCE\\u0FCF\\u0FD5-\\u0FD8\\u109E\\u109F\\u1390-\\u1399\\u1940\\u19DE-\\u19FF\\u1B61-\\u1B6A\\u1B74-\\u1B7C\\u2100\\u2101\\u2103-\\u2106\\u2108\\u2109\\u2114\\u2116\\u2117\\u211E-\\u2123\\u2125\\u2127\\u2129\\u212E\\u213A\\u213B\\u214A\\u214C\\u214D\\u214F\\u2195-\\u2199\\u219C-\\u219F\\u21A1\\u21A2\\u21A4\\u21A5\\u21A7-\\u21AD\\u21AF-\\u21CD\\u21D0\\u21D1\\u21D3\\u21D5-\\u21F3\\u2300-\\u2307\\u230C-\\u231F\\u2322-\\u2328\\u232B-\\u237B\\u237D-\\u239A\\u23B4-\\u23DB\\u23E2-\\u23F3\\u2400-\\u2426\\u2440-\\u244A\\u249C-\\u24E9\\u2500-\\u25B6\\u25B8-\\u25C0\\u25C2-\\u25F7\\u2600-\\u266E\\u2670-\\u26FF\\u2701-\\u2767\\u2794-\\u27BF\\u2800-\\u28FF\\u2B00-\\u2B2F\\u2B45\\u2B46\\u2B50-\\u2B59\\u2CE5-\\u2CEA\\u2E80-\\u2E99\\u2E9B-\\u2EF3\\u2F00-\\u2FD5\\u2FF0-\\u2FFB\\u3004\\u3012\\u3013\\u3020\\u3036\\u3037\\u303E\\u303F\\u3190\\u3191\\u3196-\\u319F\\u31C0-\\u31E3\\u3200-\\u321E\\u322A-\\u3247\\u3250\\u3260-\\u327F\\u328A-\\u32B0\\u32C0-\\u32FE\\u3300-\\u33FF\\u4DC0-\\u4DFF\\uA490-\\uA4C6\\uA828-\\uA82B\\uA836\\uA837\\uA839\\uAA77-\\uAA79\\uFDFD\\uFFE4\\uFFE8\\uFFED\\uFFEE\\uFFFC\\uFFFD",i="(?:"+("(?:"+("["+e+"](?:["+e+"\\-]*["+e+"])?")+"\\.)+")+a+"|(?:\\b(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\\.(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9][0-9]|[0-9])\\b))",o="(?:["+s+"]*(?:"+("\\(["+s+"]*(?:\\(["+s+"]*\\)["+s+"]*)*\\)"+"|"+("\\[["+s+"]*(?:\\[["+s+"]*\\]["+s+"]*)*\\]"))+"|["+(e+"/\\-+=_&~*%;"+t)+"])+)+",r="\\b(https?|ftp|wss?)://"+o+"|"+("(?:"+i+"(?::[0-9]+)?/"+("(?:"+o+"|/|\\b|$)")+")|(?:"+i+"(?::[0-9]+)?(?:\\b|$))");this.linkregex=new RegExp(r,"gi"),this._elem=n()("<div></div>")}encodeUrl(t){return t.replace(/&/g,"&amp;").replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,(function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"})).replace(/([^\#-~| |!])/g,(function(t){return"&#"+t.charCodeAt(0)+";"})).replace(/</g,"&lt;").replace(/>/g,"&gt;")}format(t,e,s=null){if(!e)return;const i=this;let n="";return/\b(?:NSFL)\b/i.test(e)?n="nsfl-link":/\b(?:NSFW|SPOILER)\b/i.test(e)&&(n="nsfw-link"),e.replace(i.linkregex,(function(t,e){e=e?"":"http://";const s=i._elem.html(t).text(),o=s.match(i.linkregex);if(o){t=i.encodeUrl(o[0]);const a=i.encodeUrl(s.substring(o[0].length));return`<a target="_blank" class="externallink ${n}" href="${e+t}" rel="nofollow">${t}</a>${a}`}return t}))}}class m{constructor(){try{const t=(window.top||window.parent||window).location;this.url=(t.protocol+"//"+t.host+t.pathname+(t.search?t.search:"")).replace(/\/$/,"")}catch(t){console.error(t)}this.bigscreenregex=new RegExp(/(^|\s)((#twitch|#twitch-vod|#twitch-clip|#youtube)\/(?:[A-z0-9_\-]{3,64}))\b/,"g")}format(t,e){return e.replace(this.bigscreenregex,'$1<a class="externallink bookmarklink" href="'+this.url+'$2" target="_top">$2</a>')}}},122:function(t){t.exports=JSON.parse('["NORTHWESTERNMUTUAL","TRAVELERSINSURANCE","AMERICANEXPRESS","KERRYPROPERTIES","SANDVIKCOROMANT","AFAMILYCOMPANY","AMERICANFAMILY","BANANAREPUBLIC","CANCERRESEARCH","COOKINGCHANNEL","KERRYLOGISTICS","WEATHERCHANNEL","INTERNATIONAL","LIFEINSURANCE","SPREADBETTING","TRAVELCHANNEL","WOLTERSKLUWER","CONSTRUCTION","LPLFINANCIAL","SCHOLARSHIPS","VERSICHERUNG","ACCOUNTANTS","BARCLAYCARD","BLACKFRIDAY","BLOCKBUSTER","BRIDGESTONE","CALVINKLEIN","CONTRACTORS","CREDITUNION","ENGINEERING","ENTERPRISES","FOODNETWORK","INVESTMENTS","KERRYHOTELS","LAMBORGHINI","MOTORCYCLES","OLAYANGROUP","PHOTOGRAPHY","PLAYSTATION","PRODUCTIONS","PROGRESSIVE","REDUMBRELLA","RIGHTATHOME","WILLIAMHILL","ACCOUNTANT","APARTMENTS","ASSOCIATES","BASKETBALL","BNPPARIBAS","BOEHRINGER","CAPITALONE","CONSULTING","CREDITCARD","CUISINELLA","EUROVISION","EXTRASPACE","FOUNDATION","HEALTHCARE","IMMOBILIEN","INDUSTRIES","MANAGEMENT","MITSUBISHI","NATIONWIDE","NEWHOLLAND","NEXTDIRECT","ONYOURSIDE","PROPERTIES","PROTECTION","PRUDENTIAL","REALESTATE","REPUBLICAN","RESTAURANT","SCHAEFFLER","SWIFTCOVER","TATAMOTORS","TECHNOLOGY","TELEFONICA","UNIVERSITY","VISTAPRINT","VLAANDEREN","VOLKSWAGEN","ACCENTURE","ALFAROMEO","ALLFINANZ","AMSTERDAM","ANALYTICS","AQUARELLE","BARCELONA","BLOOMBERG","CHRISTMAS","COMMUNITY","DIRECTORY","EDUCATION","EQUIPMENT","FAIRWINDS","FINANCIAL","FIRESTONE","FRESENIUS","FRONTDOOR","FUJIXEROX","FURNITURE","GOLDPOINT","HISAMITSU","HOMEDEPOT","HOMEGOODS","HOMESENSE","HONEYWELL","INSTITUTE","INSURANCE","KUOKGROUP","LADBROKES","LANCASTER","LANDROVER","LIFESTYLE","MARKETING","MARSHALLS","MELBOURNE","MICROSOFT","PANASONIC","PASSAGENS","PRAMERICA","RICHARDLI","SCJOHNSON","SHANGRILA","SOLUTIONS","STATEBANK","STATEFARM","STOCKHOLM","TRAVELERS","VACATIONS","YODOBASHI","ABUDHABI","AIRFORCE","ALLSTATE","ATTORNEY","BARCLAYS","BAREFOOT","BARGAINS","BASEBALL","BOUTIQUE","BRADESCO","BROADWAY","BRUSSELS","BUDAPEST","BUILDERS","BUSINESS","CAPETOWN","CATERING","CATHOLIC","CHRYSLER","CIPRIANI","CITYEATS","CLEANING","CLINIQUE","CLOTHING","COMMBANK","COMPUTER","DELIVERY","DELOITTE","DEMOCRAT","DIAMONDS","DISCOUNT","DISCOVER","DOWNLOAD","ENGINEER","ERICSSON","ESURANCE","ETISALAT","EVERBANK","EXCHANGE","FEEDBACK","FIDELITY","FIRMDALE","FOOTBALL","FRONTIER","GOODYEAR","GRAINGER","GRAPHICS","GUARDIAN","HDFCBANK","HELSINKI","HOLDINGS","HOSPITAL","INFINITI","IPIRANGA","ISTANBUL","JPMORGAN","LIGHTING","LUNDBECK","MARRIOTT","MASERATI","MCKINSEY","MEMORIAL","MERCKMSD","MORTGAGE","MOVISTAR","OBSERVER","PARTNERS","PHARMACY","PICTURES","PLUMBING","PROPERTY","REDSTONE","RELIANCE","SAARLAND","SAMSCLUB","SECURITY","SERVICES","SHOPPING","SHOWTIME","SOFTBANK","SOFTWARE","STCGROUP","SUPPLIES","SYMANTEC","TRAINING","UCONNECT","VANGUARD","VENTURES","VERISIGN","WOODSIDE","YOKOHAMA","ABOGADO","ACADEMY","AGAKHAN","ALIBABA","ANDROID","ATHLETA","AUCTION","AUDIBLE","AUSPOST","AVIANCA","BANAMEX","BAUHAUS","BENTLEY","BESTBUY","BOOKING","BROTHER","BUGATTI","CAPITAL","CARAVAN","CAREERS","CARTIER","CHANNEL","CHARITY","CHINTAI","CITADEL","CLUBMED","COLLEGE","COLOGNE","COMCAST","COMPANY","COMPARE","CONTACT","COOKING","CORSICA","COUNTRY","COUPONS","COURSES","CRICKET","CRUISES","DENTIST","DIGITAL","DOMAINS","EXPOSED","EXPRESS","FARMERS","FASHION","FERRARI","FERRERO","FINANCE","FISHING","FITNESS","FLIGHTS","FLORIST","FLOWERS","FORSALE","FROGANS","FUJITSU","GALLERY","GENTING","GODADDY","GROCERY","GUITARS","HAMBURG","HANGOUT","HITACHI","HOLIDAY","HOSTING","HOTELES","HOTMAIL","HYUNDAI","ISELECT","ISMAILI","JEWELRY","JUNIPER","KITCHEN","KOMATSU","LACAIXA","LANCOME","LANXESS","LASALLE","LATROBE","LECLERC","LIAISON","LIMITED","LINCOLN","MARKETS","METLIFE","MONSTER","NETBANK","NETFLIX","NETWORK","NEUSTAR","OKINAWA","OLDNAVY","ORGANIC","ORIGINS","PHILIPS","PIONEER","POLITIE","REALTOR","RECIPES","RENTALS","REVIEWS","REXROTH","SAMSUNG","SANDVIK","SCHMIDT","SCHWARZ","SCIENCE","SHIKSHA","SHRIRAM","SINGLES","SPIEGEL","STAPLES","STARHUB","STORAGE","SUPPORT","SURGERY","SYSTEMS","TEMASEK","THEATER","THEATRE","TICKETS","TIFFANY","TOSHIBA","TRADING","WALMART","WANGGOU","WATCHES","WEATHER","WEBSITE","WEDDING","WHOSWHO","WINDOWS","WINNERS","XFINITY","YAMAXUN","YOUTUBE","ZUERICH","ABARTH","ABBOTT","ABBVIE","ACTIVE","AFRICA","AGENCY","AIRBUS","AIRTEL","ALIPAY","ALSACE","ALSTOM","ANQUAN","ARAMCO","AUTHOR","BAYERN","BEAUTY","BERLIN","BHARTI","BLANCO","BOSTIK","BOSTON","BROKER","CAMERA","CAREER","CASEIH","CASINO","CENTER","CHANEL","CHROME","CHURCH","CIRCLE","CLAIMS","CLINIC","COFFEE","COMSEC","CONDOS","COUPON","CREDIT","CRUISE","DATING","DATSUN","DEALER","DEGREE","DENTAL","DESIGN","DIRECT","DOCTOR","DUNLOP","DUPONT","DURBAN","EMERCK","ENERGY","ESTATE","EVENTS","EXPERT","FAMILY","FLICKR","FUTBOL","GALLUP","GARDEN","GEORGE","GIVING","GLOBAL","GOOGLE","GRATIS","HEALTH","HERMES","HIPHOP","HOCKEY","HOTELS","HUGHES","IMAMAT","INSURE","INTUIT","JAGUAR","JOBURG","JUEGOS","KAUFEN","KINDER","KINDLE","KOSHER","LANCIA","LATINO","LAWYER","LEFRAK","LIVING","LOCKER","LONDON","LUXURY","MADRID","MAISON","MAKEUP","MARKET","MATTEL","MOBILE","MOBILY","MONASH","MORMON","MOSCOW","MUSEUM","MUTUAL","NAGOYA","NATURA","NISSAN","NISSAY","NORTON","NOWRUZ","OFFICE","OLAYAN","ONLINE","ORACLE","ORANGE","OTSUKA","PFIZER","PHOTOS","PHYSIO","PIAGET","PICTET","QUEBEC","RACING","REALTY","REISEN","REPAIR","REPORT","REVIEW","ROCHER","ROGERS","RYUKYU","SAFETY","SAKURA","SANOFI","SCHOOL","SCHULE","SEARCH","SECURE","SELECT","SHOUJI","SOCCER","SOCIAL","STREAM","STUDIO","SUPPLY","SUZUKI","SWATCH","SYDNEY","TAIPEI","TAOBAO","TARGET","TATTOO","TENNIS","TIENDA","TJMAXX","TKMAXX","TOYOTA","TRAVEL","UNICOM","VIAJES","VIKING","VILLAS","VIRGIN","VISION","VOTING","VOYAGE","VUELOS","WALTER","WARMAN","WEBCAM","XIHUAN","YACHTS","YANDEX","ZAPPOS","ACTOR","ADULT","AETNA","AMFAM","AMICA","APPLE","ARCHI","AUDIO","AUTOS","AZURE","BAIDU","BEATS","BIBLE","BINGO","BLACK","BOATS","BOSCH","BUILD","CANON","CARDS","CHASE","CHEAP","CISCO","CITIC","CLICK","CLOUD","COACH","CODES","CROWN","CYMRU","DABUR","DANCE","DEALS","DELTA","DODGE","DRIVE","DUBAI","EARTH","EDEKA","EMAIL","EPOST","EPSON","FAITH","FEDEX","FINAL","FOREX","FORUM","GALLO","GAMES","GIFTS","GIVES","GLADE","GLASS","GLOBO","GMAIL","GREEN","GRIPE","GROUP","GUCCI","GUIDE","HOMES","HONDA","HORSE","HOUSE","HYATT","IKANO","INTEL","IRISH","IVECO","JETZT","KOELN","KYOTO","LAMER","LEASE","LEGAL","LEXUS","LILLY","LINDE","LIPSY","LIXIL","LOANS","LOCUS","LOTTE","LOTTO","LUPIN","MACYS","MANGO","MEDIA","MIAMI","MONEY","MOPAR","MOVIE","NADEX","NEXUS","NIKON","NINJA","NOKIA","NOWTV","OMEGA","OSAKA","PARIS","PARTS","PARTY","PHONE","PHOTO","PIZZA","PLACE","POKER","PRAXI","PRESS","PRIME","PROMO","QUEST","RADIO","REHAB","REISE","RICOH","ROCKS","RODEO","RUGBY","SALON","SENER","SEVEN","SHARP","SHELL","SHOES","SKYPE","SLING","SMART","SMILE","SOLAR","SPACE","SPORT","STADA","STORE","STUDY","STYLE","SUCKS","SWISS","TATAR","TIRES","TIROL","TMALL","TODAY","TOKYO","TOOLS","TORAY","TOTAL","TOURS","TRADE","TRUST","TUNES","TUSHU","UBANK","VEGAS","VIDEO","VODKA","VOLVO","WALES","WATCH","WEBER","WEIBO","WORKS","WORLD","XEROX","YAHOO","ZIPPO","local","onion","AARP","ABLE","ADAC","AERO","AIGO","AKDN","ALLY","AMEX","ARAB","ARMY","ARPA","ARTE","ASDA","ASIA","AUDI","AUTO","BABY","BAND","BANK","BBVA","BEER","BEST","BIKE","BING","BLOG","BLUE","BOFA","BOND","BOOK","BUZZ","CAFE","CALL","CAMP","CARE","CARS","CASA","CASE","CASH","CBRE","CERN","CHAT","CITI","CITY","CLUB","COOL","COOP","CYOU","DATA","DATE","DCLK","DEAL","DELL","DESI","DIET","DISH","DOCS","DOHA","DUCK","DUNS","DVAG","ERNI","FAGE","FAIL","FANS","FARM","FAST","FIAT","FIDO","FILM","FIRE","FISH","FLIR","FOOD","FORD","FREE","FUND","GAME","GBIZ","GENT","GGEE","GIFT","GMBH","GOLD","GOLF","GOOG","GUGE","GURU","HAIR","HAUS","HDFC","HELP","HERE","HGTV","HOST","HSBC","ICBC","IEEE","IMDB","IMMO","INFO","ITAU","JAVA","JEEP","JOBS","JPRS","KDDI","KIWI","KPMG","KRED","LAND","LEGO","LGBT","LIDL","LIFE","LIKE","LIMO","LINK","LIVE","LOAN","LOFT","LOVE","LTDA","LUXE","MAIF","MEET","MEME","MENU","MINI","MINT","MOBI","MODA","MOTO","NAME","NAVY","NEWS","NEXT","NICO","NIKE","OLLO","OPEN","PAGE","PARS","PCCW","PICS","PING","PINK","PLAY","PLUS","POHL","PORN","POST","PROD","PROF","QPON","RAID","READ","REIT","RENT","REST","RICH","RMIT","ROOM","RSVP","RUHR","SAFE","SALE","SARL","SAVE","SAXO","SCOR","SCOT","SEAT","SEEK","SEXY","SHAW","SHIA","SHOP","SHOW","SILK","SINA","SITE","SKIN","SNCF","SOHU","SONG","SONY","SPOT","STAR","SURF","TALK","TAXI","TEAM","TECH","TEVA","TIAA","TIPS","TOWN","TOYS","TUBE","VANA","VISA","VIVA","VIVO","VOTE","VOTO","WANG","WEIR","WIEN","WIKI","WINE","WORK","XBOX","YOGA","ZARA","ZERO","ZONE","exit","zkey","AAA","ABB","ABC","ACO","ADS","AEG","AFL","AIG","ANZ","AOL","APP","ART","AWS","AXA","BAR","BBC","BBT","BCG","BCN","BET","BID","BIO","BIZ","BMS","BMW","BNL","BOM","BOO","BOT","BOX","BUY","BZH","CAB","CAL","CAM","CAR","CAT","CBA","CBN","CBS","CEB","CEO","CFA","CFD","COM","CRS","CSC","DAD","DAY","DDS","DEV","DHL","DIY","DNP","DOG","DOT","DTV","DVR","EAT","ECO","EDU","ESQ","EUS","FAN","FIT","FLY","FOO","FOX","FRL","FTR","FUN","FYI","GAL","GAP","GDN","GEA","GLE","GMO","GMX","GOO","GOP","GOT","GOV","HBO","HIV","HKT","HOT","HOW","IBM","ICE","ICU","IFM","INC","ING","INK","INT","IST","ITV","JCB","JCP","JIO","JLL","JMP","JNJ","JOT","JOY","KFH","KIA","KIM","KPN","KRD","LAT","LAW","LDS","LLC","LOL","LPL","LTD","MAN","MAP","MBA","MED","MEN","MIL","MIT","MLB","MLS","MMA","MOE","MOI","MOM","MOV","MSD","MTN","MTR","NAB","NBA","NEC","NET","NEW","NFL","NGO","NHK","NOW","NRA","NRW","NTT","NYC","OBI","OFF","ONE","ONG","ONL","OOO","ORG","OTT","OVH","PAY","PET","PHD","PID","PIN","PNC","PRO","PRU","PUB","PWC","QVC","RED","REN","RIL","RIO","RIP","RUN","RWE","SAP","SAS","SBI","SBS","SCA","SCB","SES","SEW","SEX","SFR","SKI","SKY","SOY","SRL","SRT","STC","TAB","TAX","TCI","TDK","TEL","THD","TJX","TOP","TRV","TUI","TVS","UBS","UNO","UOL","UPS","VET","VIG","VIN","VIP","WED","WIN","WME","WOW","WTC","WTF","XIN","XXX","XYZ","YOU","YUN","ZIP","bit","gnu","i2p","AC","AD","AE","AF","AG","AI","AL","AM","AO","AQ","AR","AS","AT","AU","AW","AX","AZ","BA","BB","BD","BE","BF","BG","BH","BI","BJ","BM","BN","BO","BR","BS","BT","BV","BW","BY","BZ","CA","CC","CD","CF","CG","CH","CI","CK","CL","CM","CN","CO","CR","CU","CV","CW","CX","CY","CZ","DE","DJ","DK","DM","DO","DZ","EC","EE","EG","ER","ES","ET","EU","FI","FJ","FK","FM","FO","FR","GA","GB","GD","GE","GF","GG","GH","GI","GL","GM","GN","GP","GQ","GR","GS","GT","GU","GW","GY","HK","HM","HN","HR","HT","HU","ID","IE","IL","IM","IN","IO","IQ","IR","IS","IT","JE","JM","JO","JP","KE","KG","KH","KI","KM","KN","KP","KR","KW","KY","KZ","LA","LB","LC","LI","LK","LR","LS","LT","LU","LV","LY","MA","MC","MD","ME","MG","MH","MK","ML","MM","MN","MO","MP","MQ","MR","MS","MT","MU","MV","MW","MX","MY","MZ","NA","NC","NE","NF","NG","NI","NL","NO","NP","NR","NU","NZ","OM","PA","PE","PF","PG","PH","PK","PL","PM","PN","PR","PS","PT","PW","PY","QA","RE","RO","RS","RU","RW","SA","SB","SC","SD","SE","SG","SH","SI","SJ","SK","SL","SM","SN","SO","SR","ST","SU","SV","SX","SY","SZ","TC","TD","TF","TG","TH","TJ","TK","TL","TM","TN","TO","TR","TT","TV","TW","TZ","UA","UG","UK","US","UY","UZ","VA","VC","VE","VG","VI","VN","VU","WF","WS","YE","YT","ZA","ZM","ZW"]')},124:function(t,e){t.exports='<div id=chat class=chat> <div id=chat-windows-select></div> <div id=chat-vote-frame></div> <div id=chat-output-frame data-scroll-notify></div> <div id=chat-input-frame> <div id=chat-input-wrap> <textarea id=chat-input-control placeholder="Getting things ready ..." autocomplete=off tabindex=1 autofocus spellcheck></textarea> </div> <div id=chat-tools-wrap> <div class=chat-tools-group> <a id=chat-emoticon-btn class=chat-tool-btn title=Emotes> <i class=btn-icon></i> </a> <a id=chat-whisper-btn class=chat-tool-btn title=Whispers> <i class=btn-icon></i> </a> </div> <div class=chat-tools-group> <a id=chat-settings-btn class=chat-tool-btn title=Settings> <i class=btn-icon></i> </a> <a id=chat-users-btn class=chat-tool-btn title=Users> <i class=btn-icon></i> </a> </div> </div> </div> <div id=chat-settings class="chat-menu right"> <div class=chat-menu-inner> <div class=toolbar> <h5><span>Settings</span> <i class=chat-menu-close></i></h5> </div> <div class="scrollable nano"> <div class="content nano-content"> <div id=chat-settings-form> <div class="form-group checkbox"> <label title="Persistent profile settings"> <input name=profilesettings type=checkbox /> Save settings to profile </label> </div> <div class=form-group> <label for=fontscale>Font Scaling</label> <select class=form-control id=fontscale name=fontscale> <option value=auto>Auto Scale</option> <option value=none>No Scale</option> <option value=small>Size Small</option> <option value=medium>Size Medium</option> <option value=large>Size Large</option> </select> </div> <h4>Messages</h4> <div class="form-group checkbox"> <label title="Show all user flair icons"> <input name=hideflairicons type=checkbox data-opposite/> Show flairs </label> </div> <div class="form-group checkbox"> <label title="Show the timestamps next to the messages"> <input name=showtime type=checkbox /> Show time </label> </div> <div class="form-group checkbox"> <label title="Ignore messages that mention ignored users"> <input name=ignorementions type=checkbox /> Harsh ignore </label> </div> <div class="form-group checkbox"> <label title="Hide messages that contain links to not safe for work content"> <input name=hidensfw type=checkbox /> Hide messages with nsfw </label> </div> <div class="form-group checkbox"> <label title="Hide messages that contain links to not safe for life content"> <input name=hidensfl type=checkbox /> Hide messages with nsfl </label> </div> <div class=form-group> <label for=showremoved>Banned messages</label> <select class=form-control id=showremoved name=showremoved> <option value=0>remove</option> <option value=1>&lt;censored&gt;</option> <option value=2>do nothing</option> </select> </div> <h4>Notifications</h4> <div class="form-group checkbox"> <label title="Notification auto close"> <input name=notificationtimeout type=checkbox /> Close after short period </label> </div> <div class=form-group> <p><small id=chat-settings-notification-permissions>(Permission unknown)</small></p> </div> <h4>Whispers</h4> <div class="form-group checkbox"> <label title="Notification on whisper"> <input name=notificationwhisper type=checkbox /> Notification </label> </div> <div class="form-group checkbox"> <label title="Whispers shown in chat"> <input name=showhispersinchat type=checkbox /> In-line messages </label> </div> <h4>Highlights, Focus &amp; Tags</h4> <div class="form-group checkbox"> <label title="Notification on highlight"> <input name=notificationhighlight type=checkbox /> Notification </label> </div> <div class="form-group checkbox"> <label title="Highlights messages you are mentioned in"> <input name=highlight type=checkbox /> Highlight when mentioned </label> </div> <div class="form-group checkbox"> <label title="Include mentions when focused"> <input name=focusmentioned type=checkbox /> Include mentions when <span title="Occurs when you click on a user in chat.">focused</span> </label> </div> <div class="form-group checkbox"> <label> <input name=taggedvisibility type=checkbox /> Increased visibility of tagged users </label> </div> <div class="form-group row"> <label title="Highlights usernames or text that match">Custom Highlights</label> <textarea name=customhighlight style=resize:vertical class=form-control placeholder="Comma separated ..."></textarea> </div> <h4>Autocomplete</h4> <div class="form-group checkbox"> <label title="Toggle the auto-complete suggestion tabs ..."> <input name=autocompletehelper type=checkbox /> Auto-complete helper </label> </div> </div> </div> </div> </div> </div> <div id=chat-user-list class="chat-menu right"> <div class=chat-menu-inner> <div class=toolbar> <h5><span>Users</span> <i class=chat-menu-close></i></h5> </div> <div class="scrollable nano"> <div class="content nano-content"></div> </div> <div id=chat-user-list-search> <input type=text class=form-control value="" placeholder="Username search ..."/> </div> </div> </div> <div id=chat-emote-list class="chat-menu left"> <div class=chat-menu-inner> <div class=toolbar> <h5><span>Emotes</span> <i class=chat-menu-close></i></h5> </div> <div class="scrollable nano"> <div class="content nano-content"> <div class=emote-group id=destiny-emotes></div> <div id=emote-subscribe-note>Twitch subscribers only</div> <div class=emote-group id=twitch-emotes></div> </div> </div> </div> </div> <div id=chat-whisper-users class="chat-menu left"> <div class=chat-menu-inner> <div class=toolbar> <h5><span>Whispers</span> <i class=chat-menu-close></i></h5> </div> <div class="scrollable nano"> <div class="content nano-content"> <ul></ul> </div> </div> </div> </div> <div id=chat-login-screen style=display:none> <h2>Want to chat?</h2> <p>You need to be signed in.<br/>Become part of the community and have your say!</p> <div> <button id=chat-btn-login class="btn btn-primary">Login</button> <button id=chat-btn-cancel class="btn btn-default">No thanks</button> </div> </div> <div id=chat-loading> <div> <i class=chat-loading-icon></i> </div> </div> </div>'},126:function(t,e){t.exports='<div id=chat class="chat onstreamchat"> <div id=chat-vote-frame></div> <div id=chat-output-frame></div> </div>'},17:function(t,e,s){"use strict";var i=s(6);const n=function(t,e,s){if(!("Notification"in t&&"permission"in t.Notification&&"requestPermission"in t.Notification)){const i="default",n="granted",o="denied",a=[n,i,o],r=function(t){return t&&t.constructor===String},u=function(t){return t&&t.constructor===Function},h=function(t){return t&&t.constructor===Object},c=function(){},l=window.localStorage||{setItem:c,getItem:c},d=function(){let e;return e="webkitNotifications"in t&&"checkPermission"in t.webkitNotifications?a[t.webkitNotifications.checkPermission()]:"mozNotification"in s?n:null===l.getItem("notifications")?i:l.getItem("notifications"),e},m=function(s){let a=u(s)?s:c;"webkitNotifications"in t&&"requestPermission"in t.webkitNotifications?t.webkitNotifications.requestPermission(a):(d()===i&&(confirm("Do you want to allow "+e.domain+" to display Notifications?")?(l.setItem("notifications",n),A.permission=n):(l.setItem("notifications",o),A.permission=o)),a())},A=function(e,i){let o;return r(e)&&h(i)&&d()===n&&("mozNotification"in s?(o=s.mozNotification.createNotification(e,i.body,i.icon),u(i.onclick)&&(o.onclick=i.onclick),u(i.onclose)&&(o.onclose=i.onclose),o.show()):"webkitNotifications"in t&&"createNotification"in t.webkitNotifications&&(o=t.webkitNotifications.createNotification(i.icon,e,i.body),u(i.onclick)&&(o.onclick=i.onclick),u(i.onshow)&&(o.onshow=i.onshow),u(i.onerror)&&(o.onerror=i.onerror),u(i.onclose)&&(o.onclose=i.onclose),o.show())),o};"Notification"in t||(A.requestPermission=m,t.Notification=A),"webkitNotifications"in t&&"checkPermission"in t.webkitNotifications?Object.defineProperty(t.Notification,"permission",{get:function(){return a[t.webkitNotifications.checkPermission()]}}):A.permission=d(),"requestPermission"in t.Notification||(t.Notification.requestPermission=m)}return t.Notification}(window,document,navigator);var o=s(0),a=s.n(o);const r={FULL:"MMMM Do YYYY, h:mm:ss a",TIME:"HH:mm"},u={TAB:9,STRG:17,CTRL:17,CTRLRIGHT:18,CTRLR:18,SHIFT:16,RETURN:13,ENTER:13,BACKSPACE:8,BCKSP:8,ALT:18,ALTR:17,ALTRIGHT:17,SPACE:32,WIN:91,MAC:91,UP:38,DOWN:40,LEFT:37,RIGHT:39,ESC:27,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};function h(t){return t.which||t.keyCode||-1}function c(t,e){return h(t)===e}var l=s(4),d=s(2),m=s.n(d);var A=class{constructor(){this.listeners=new Map}on(t,e){return this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e),this}emit(t,...e){const s=this.listeners.get(t);return!(!s||!s.length)&&(s.forEach(t=>t(...e)),!0)}};const g=window.WebSocket||window.MozWebSocket;var E=class extends A{constructor(){super(),this.socket=null,this.url=null,this.retryOnDisconnect=!0,this.retryAttempts=0,this.retryTimer=null}isConnected(){return this.socket&&this.socket.readyState===this.socket.OPEN}connect(t){this.url=t,this.retryAttempts++;try{null!==this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null),null!==this.socket&&(this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.disconnect(),this.socket=null),this.emit("CONNECTING",this.url),this.socket=new g(this.url),this.socket.onopen=t=>this.onOpen(t),this.socket.onclose=t=>this.onClose(t),this.socket.onmessage=t=>this.onMsg(t),this.socket.onerror=t=>this.emit("SOCKETERROR",t)}catch(t){this.emit("SOCKETERROR",t)}}disconnect(){this.socket&&this.socket.readyState!==this.socket.CLOSED&&this.socket.close()}onOpen(t){this.emit("OPEN",t),this.retryAttempts=0,this.retryOnDisconnect=!0}onClose(t){let e=0;this.retryOnDisconnect&&(e=0===this.retryAttempts?Math.floor(2500*Math.random())+501:Math.floor(25001*Math.random())+5e3,this.retryTimer=setTimeout(()=>this.connect(this.url),e)),this.emit("CLOSE",{code:t.code||1006,retryMilli:e})}onMsg(t){this.parseAndDispatch(t)}parseAndDispatch(t){let e=t.data.split(" ",1)[0].toUpperCase(),s=t.data.substring(e.length+1),i=null;try{i=JSON.parse(s)}catch(t){i=s}this.emit("DISPATCH",{data:i,event:e}),this.emit(e,i)}send(t,e){const s="string"==typeof e?e:JSON.stringify(e);this.isConnected()?this.socket.send(`${t} ${s}`):this.emit("ERR","notconnected")}};var p=class{constructor(t={}){"string"==typeof t?(this.nick=t,this.username=t,this.features=[]):(this.nick=t.nick||"",this.username=t.nick||"",this.features=t.features||[])}hasAnyFeatures(...t){for(const e of t)if(-1!==this.features.indexOf("string"!=typeof e?e.toString():e))return!0;return!1}hasFeature(t){return this.hasAnyFeatures(t)}},C=s(11);const f={STATUS:"STATUS",ERROR:"ERROR",INFO:"INFO",COMMAND:"COMMAND",BROADCAST:"BROADCAST",UI:"UI",CHAT:"CHAT",USER:"USER",EMOTE:"EMOTE"},S=new Map;function T(t,e){let s="/me "===e.message.substring(0,4).toLowerCase()?e.message.substring(4):e.message;return S.forEach(i=>s=i.format(t,s,e)),`<span class="text">${s}</span>`}function I(t){return`<time class="time" title="${t.timestamp.format(r.FULL)}">${t.timestamp.format(r.TIME)}</time>`}S.set("html",new C.d),S.set("url",new C.f),S.set("emote",new C.b),S.set("mentioned",new C.e),S.set("green",new C.c),S.set("embed",new C.a);class O{static element(t,e=[]){return new N(t,e)}static status(t,e=null){return new w(t,e,f.STATUS)}static error(t,e=null){return new w(t,e,f.ERROR)}static info(t,e=null){return new w(t,e,f.INFO)}static broadcast(t,e=null){return new w(t,e,f.BROADCAST)}static command(t,e=null){return new w(t,e,f.COMMAND)}static message(t,e,s=null){return new R(t,e,s)}static emote(t,e,s=1){return new B(t,e,s)}static whisper(t,e,s,i=null,n=null){const o=new R(t,e,i);return o.id=n,o.target=s,o}static historical(t,e,s=null){const i=new R(t,e,s);return i.historical=!0,i}}class N{constructor(t,e=[]){this.type=f.UI,this.message=t,this.classes=e,this.ui=null}into(t,e=null){return t.addMessage(this,e),this}wrap(t,e=[],s={}){return e.push(this.classes),e.unshift(`msg-${this.type.toLowerCase()}`),e.unshift("msg-chat"),s.class=e.join(" "),a()("<div></div>",s).html(t)[0].outerHTML}html(t=null){return this.wrap(this.message)}afterRender(t=null){}}class w extends N{constructor(t,e=null,s=f.CHAT){super(t),this.user=null,this.type=s,this.continued=!1,this.timestamp=e?m.a.utc(e).local():m()()}html(t=null){const e=[];return this.continued&&e.push("msg-continue"),this.wrap(`${I(this)} ${T(t,this)}`,e,{})}}class R extends w{constructor(t,e,s=null){super(t,s,f.USER),this.user=e,this.id=null,this.isown=!1,this.highlighted=!1,this.historical=!1,this.target=null,this.tag=null,this.title="",this.slashme=!1,this.mentioned=[]}html(t=null){const e=[],s={};this.id&&(s["data-id"]=this.id),this.user&&this.user.username&&(s["data-username"]=this.user.username.toLowerCase()),this.mentioned&&this.mentioned.length>0&&(s["data-mentioned"]=this.mentioned.join(" ").toLowerCase()),this.isown&&e.push("msg-own"),this.slashme&&e.push("msg-me"),this.historical&&e.push("msg-historical"),this.highlighted&&e.push("msg-highlight"),this.continued&&!this.target&&e.push("msg-continue"),this.tag&&e.push(`msg-tagged msg-tagged-${this.tag}`),this.target&&e.push("msg-whisper");let i=": ";this.target?i=" whispered: ":(this.slashme||this.continued)&&(i="");const n=function(t,e){const s=(t.features||[]).filter(t=>e.flairsMap.has(t)).map(t=>e.flairsMap.get(t)).reduce((t,e)=>t+`<i class="flair ${e.name}" title="${e.label}"></i> `,"");return""!==s?`<span class="features">${s}</span>`:""}(this.user,t)+` <a title="${this.title}" class="user ${this.user.features.join(" ")}">${this.user.username}</a>`;return this.wrap(I(this)+` ${n}<span class="ctrl">${i}</span> `+T(t,this),e,s)}}function F(t){if(!t||!t._combo)return;let e="";t.emotecount>=50?e=" x50":t.emotecount>=30?e=" x30":t.emotecount>=20?e=" x20":t.emotecount>=10?e=" x10":t.emotecount>=5&&(e=" x5"),t._combo||console.error("no combo",t._combo),t._combo.attr("class","chat-combo"+e),t._combo_count.text(`${t.emotecount}`),t.ui.append(t._text.detach(),t._combo.detach())}const v=Object(l.b)(63,F);class B extends w{constructor(t,e,s=1){super(t,e,f.EMOTE),this.emotecount=s}html(t=null){return this._text=a()(`<span class="text">${S.get("emote").format(t,this.message,this)}</span>`),this._combo=a()('<span class="chat-combo"></span>'),this._combo_count=a()(`<i class="count">${this.emotecount}</i>`),this._combo_x=a()('<i class="x">X</i>'),this._combo_hits=a()('<i class="hit">Hits</i>'),this._combo_txt=a()('<i class="combo">C-C-C-COMBO</i>'),this.wrap(I(this))}afterRender(t=null){this._combo.append(this._combo_count," ",this._combo_x," ",this._combo_hits," ",this._combo_txt),this.ui.append(this._text,this._combo)}incEmoteCount(){++this.emotecount,v(this)}completeCombo(){F(this),this._combo.attr("class",this._combo.attr("class")+" combo-complete"),this._combo=this._combo_count=this._combo_x=this._combo_hits=this._combo_txt=null}}s(48);const L="ontouchstart"in window||navigator.maxTouchPoints;var b=class{constructor(t,e){if(!a()(e).get(0))return;const s=a()(e);s.find(".chat-scroll-notify").length>0&&(s.on("update",()=>s.toggleClass("chat-unpinned",!this.isPinned())),s.on("mousedown",".chat-scroll-notify",()=>!1),s.on("mouseup",".chat-scroll-notify",()=>(this.updateAndPin(!0),!1))),this.scroller=s.nanoScroller({sliderMinHeight:40,disableResize:!0,alwaysVisible:L})[0].nanoscroller}isPinned(){return!this.scroller.isActive||this.scroller.contentScrollTop>=this.scroller.maxScrollTop-30}updateAndPin(t){this.reset(),t&&this.scroller.scrollBottom(0)}reset(){this.scroller.reset()}destroy(){this.scroller.destroy()}},D=s(3);function M(t){return`<div class="emote-item"><span title="${t}" class="emote ${t}">${t}</span></div>`}function k(t,e){const s=this.chat.users.get(t.getAttribute("data-username").toLowerCase()),i=this.chat.users.get(e.getAttribute("data-username").toLowerCase());if(!s||!i)return 0;let n,o;if(n=s.hasFeature(D.a.ADMIN)||s.hasFeature(D.a.VIP),o=i.hasFeature(D.a.ADMIN)||i.hasFeature(D.a.VIP),n>o)return-1;if(n<o)return 1;if(n=s.hasFeature(D.a.BOT2),o=i.hasFeature(D.a.BOT2),n>o)return 1;if(n<o)return-1;if(n=s.hasFeature(D.a.BOT),o=i.hasFeature(D.a.BOT),n>o)return 1;if(n<o)return-1;if(n=s.hasFeature(D.a.BROADCASTER)||s.hasFeature(D.a.BROADCASTER),o=i.hasFeature(D.a.BROADCASTER)||i.hasFeature(D.a.BROADCASTER),n>o)return-1;if(n<o)return 1;if(n=s.hasFeature(D.a.SUBSCRIBER)||s.hasFeature(D.a.SUBSCRIBER),o=i.hasFeature(D.a.SUBSCRIBER)||i.hasFeature(D.a.SUBSCRIBER),n>o)return-1;if(n<o)return 1;let a=s.nick.toLowerCase(),r=i.nick.toLowerCase();return a<r?-1:a>r?1:0}class U extends A{constructor(t,e,s){super(),this.ui=t,this.btn=e,this.chat=s,this.visible=!1,this.shown=!1,this.ui.find(".scrollable").each((t,e)=>{this.scrollplugin=new b(s,e)}),this.ui.on("click",".close,.chat-menu-close",this.hide.bind(this)),this.btn.on("click",t=>(this.visible&&s.input.focus(),this.toggle(t),!1))}show(){this.visible||(this.visible=!0,this.shown=!0,this.btn.addClass("active"),this.ui.addClass("active"),this.redraw(),this.emit("show"))}hide(){this.visible&&(this.visible=!1,this.btn.removeClass("active"),this.ui.removeClass("active"),this.emit("hide"))}toggle(){const t=this.visible;U.closeMenus(this.chat),t||this.show()}redraw(){this.visible&&this.scrollplugin&&this.scrollplugin.reset()}static closeMenus(t){t.menus.forEach(t=>t.hide())}}class y extends U{constructor(t,e,s){super(t,e,s),this.notificationEl=this.ui.find("#chat-settings-notification-permissions"),this.ui.on("change",'input[type="checkbox"],select',t=>this.onSettingsChange(t)),this.ui.on("keypress blur",'textarea[name="customhighlight"]',t=>this.onCustomHighlightChange(t))}onCustomHighlightChange(t){if(!c(t,u.ENTER))return;let e=a()(t.target).val().toString().split(",").map(t=>t.trim());this.chat.settings.set("customhighlight",[...new Set(e)]),this.chat.applySettings(!1),this.chat.commitSettings()}onSettingsChange(t){const e=function(t){if("checkbox"===t.getAttribute("type")){const e=a()(t).is(":checked");return Boolean(t.hasAttribute("data-opposite")?!e:e)}if("text"===t.getAttribute("type")||"select"===t.nodeName.toLocaleLowerCase())return a()(t).val()}(t.target),s=t.target.getAttribute("name");if(void 0!==e){switch(s){case"profilesettings":!e&&this.chat.authenticated&&Object(i.a)(`${this.config.api.base}/api/chat/me/settings`,{credentials:"include",method:"DELETE"}).catch(console.warn);break;case"notificationwhisper":case"notificationhighlight":e&&this.notificationPermission().then(()=>this.updateNotification())}this.chat.settings.set(s,e),this.chat.applySettings(!1),this.chat.commitSettings()}}show(){this.visible||(this.ui.find("input,select").get().filter(t=>this.chat.settings.has(t.getAttribute("name"))).forEach(t=>(function(t,e){"checkbox"===t.getAttribute("type")?a()(t).prop("checked",Boolean(t.hasAttribute("data-opposite")?!e:e)):"text"!==t.getAttribute("type")&&"select"!==t.nodeName.toLocaleLowerCase()||a()(t).val(e)})(t,this.chat.settings.get(t.getAttribute("name")))),this.ui.find('textarea[name="customhighlight"]').val(this.chat.settings.get("customhighlight")||""),this.updateNotification()),super.show()}updateNotification(){const t="default"===n.permission?"required":n.permission;this.notificationEl.text(`(Permission ${t})`)}notificationPermission(){return new Promise((t,e)=>{switch(n.permission){case"default":n.requestPermission(s=>{switch(s){case"granted":t(s);break;default:e(s)}});break;case"granted":t(n.permission);break;case"denied":default:e(n.permission)}})}}class P extends U{constructor(t,e,s){super(t,e,s),this.searchterm="",this.searchcount=0,this.totalcount=0,this.header=this.ui.find("h5 span"),this.container=this.ui.find(".content:first"),this.searchinput=this.ui.find("#chat-user-list-search .form-control:first"),this.container.on("click",".user",t=>this.chat.userfocus.toggleFocus(t.target.getAttribute("data-username"))),this.container.on("click",".whisper-nick",t=>{U.closeMenus(this.chat);const e=this.chat.input.val().toString().trim(),s=a()(t.target).parent().data("username");return this.chat.input.val(e+(""===e?"":" ")+s+" ").focus(),!1}),this.chat.source.on("JOIN",t=>this.addAndRedraw(t.nick)),this.chat.source.on("QUIT",t=>this.removeAndRedraw(t.nick)),this.chat.source.on("NAMES",t=>this.addAll()),this.searchinput.on("keyup",Object(l.a)(100,!1,()=>{this.searchterm=this.searchinput.val(),this.filter(),this.redraw()}))}show(){super.show(),this.searchinput.focus()}redraw(){if(this.visible){const t=this.searchterm.length>0;t&&this.totalcount!==this.searchcount?this.header.text(`Users (${this.searchcount} out of ${this.totalcount})`):this.header.text(`Users (${this.totalcount})`),this.ui.toggleClass("search-in",t)}super.redraw()}addAll(){this.totalcount=0,this.container.empty(),[...this.chat.users.keys()].forEach(t=>this.addElement(t)),this.sort(),this.filter(),this.redraw()}addAndRedraw(t){this.hasElement(t)||(this.addElement(t,!0),this.filter(),this.redraw())}removeAndRedraw(t){this.hasElement(t)&&(this.removeElement(t),this.redraw())}removeElement(t){this.container.find(`.user[data-username="${t}"]`).remove(),this.totalcount--}addElement(t,e=!1){const s=this.chat.users.get(t.toLowerCase()),i=s.username&&""!==s.username?s.username:"Anonymous",n=0===s.features.length?"nofeature":s.features.join(" "),o=a()(`<a data-username="${s.username}" class="user ${n}"><i class="whisper-nick"></i> ${i}</a>`);if(e&&this.totalcount>0){const t=this.container.children(".user").get();let e=0,s=t.length,i=Math.floor((e+s)/2);for(;s>e;)k.apply(this,[o[0],t[i]])<0?s=i:e=i+1,i=Math.floor((e+s)/2);o.insertAfter(t[i])}else this.container.append(o);this.totalcount++}hasElement(t){return this.container.find('.user[data-username="'+t+'"]').length>0}filter(){this.searchcount=0,this.searchterm&&this.searchterm.length>0?this.container.children(".user").get().forEach(t=>{const e=t.getAttribute("data-username").toLowerCase().indexOf(this.searchterm.toLowerCase())>=0;a()(t).toggleClass("found",e),e&&this.searchcount++}):this.container.children(".user").removeClass("found")}sort(){this.container.children(".user").get().sort(k.bind(this)).forEach(t=>t.parentNode.appendChild(t))}}class H extends U{constructor(t,e,s){super(t,e,s),this.temotes=this.ui.find("#twitch-emotes"),this.demotes=this.ui.find("#destiny-emotes"),this.ui.on("click",".emote",t=>{U.closeMenus(s),this.selectEmote(t.currentTarget.innerText)})}show(){this.visible||this.chat.input.focus(),super.show(),this.demotes.empty().append(this.chat.emotes.filter(t=>!t.twitch).map(t=>t.prefix).map(M).join("")),this.temotes.empty().append(this.chat.emotes.filter(t=>t.twitch).map(t=>t.prefix).map(M).join(""))}selectEmote(t){let e=this.chat.input.val().toString().trim();this.chat.input.val(e+(""===e?"":" ")+t+" ").focus()}}class G extends U{constructor(t,e,s){super(t,e,s),this.unread=0,this.empty=a()('<span class="empty">No new whispers :(</span>'),this.notif=a()('<span id="chat-whisper-unread-indicator"></span>'),this.btn.append(this.notif),this.usersEl=t.find("ul:first"),this.usersEl.on("click",".user",t=>s.openConversation(t.target.getAttribute("data-username"))),this.usersEl.on("click",".remove",t=>this.removeConversation(t.target.getAttribute("data-username")))}removeConversation(t){const e=t.toLowerCase();this.chat.whispers.delete(e),this.chat.removeWindow(e),this.redraw()}updateNotification(){const t=this.unread;this.unread=[...this.chat.whispers.entries()].map(t=>parseInt(t[1].unread)).reduce((t,e)=>t+e,0),t<this.unread&&(this.btn.addClass("ping"),setTimeout(()=>this.btn.removeClass("ping"),2e3)),this.notif.text(this.unread),this.notif.toggle(this.unread>0);try{const t=window.parent.document.title.replace(/^\([0-9]+\) /,"");window.parent.document.title=this.unread>0?`(${this.unread}) ${t}`:`${t}`}catch(t){console.error(t)}}redraw(){this.updateNotification(),this.visible&&(this.usersEl.empty(),0===this.chat.whispers.size?this.usersEl.append(this.empty):[...this.chat.whispers.entries()].sort((t,e)=>0===t[1].unread?1:0===e[1].unread?-1:t[1]===e[1]?0:void 0).forEach(t=>this.addConversation(t[0],t[1].unread))),super.redraw()}addConversation(t,e){const s=this.chat.users.get(t.toLowerCase())||new p(t);this.usersEl.append(`\n            <li class="conversation unread-${e}">\n                <a style="flex: 1;" data-username="${s.nick.toLowerCase()}" class="user">${s.nick}</a>\n                <span class="badge">${e}</span>\n                <a data-username="${s.nick.toLowerCase()}" title="Hide" class="remove"></a>\n            </li>\n        `)}}let x,$=1,V=20;function Y(t){return(t.match(/[\S]/)[0]||"_").toLowerCase()}function K(t){t.selected>=0&&t.results[t.selected]&&(t.results[t.selected].weight=Date.now())}function W(t,e){return t&&e?t.isemote!==e.isemote?t.isemote&&!e.isemote?-1:1:t.weight!==e.weight?t.weight>e.weight?-1:1:(t=t.data.toLowerCase())===(e=e.data.toLowerCase())?0:t>e?1:-1:0}function j(t,e){let s=t.substring(0,e),i=t.substring(e),n=s.lastIndexOf(" ")+1,o=i.indexOf(" "),a=!1;return n>0&&(s=s.substring(n)),o>-1&&(i=i.substring(0,o)),0===s.lastIndexOf("@")&&(n++,s=s.substring(1),a=!0),{word:s+i,pre:s,post:i,startCaret:n,useronly:a,orig:t}}function X(t){t.chat.ui.toggleClass("chat-autocomplete-in",t.results.length>0),t.ui.toggleClass("active",t.results.length>0)}function _(t){if(-1!==t.selected&&t.results.length>0){const e=t.ui.find("li").get(),s=t.container.position().left,i=t.ui.width();a()(e[t.selected+3]).each((e,n)=>{const o=a()(n).position().left+s+a()(n).outerWidth();o>i&&t.container.css("left",s+i-o)}),a()(e[Math.max(0,t.selected-2)]).each((e,i)=>{a()(i).position().left+s<0&&t.container.css("left",a()(i).position().left)}),e.forEach((e,s)=>a()(e).toggleClass("active",s===t.selected))}}var J=class{constructor(){this.ui=a()('<div id="chat-auto-complete"><ul></ul></div>'),this.ui.on("click","li",t=>this.select(parseInt(t.currentTarget.getAttribute("data-index")))),this.container=a()(this.ui[0].firstElementChild),this.buckets=new Map,this.results=[],this.criteria=null,this.selected=-1,this.input=null}bind(t){this.chat=t,this.input=t.input,this.ui.insertBefore(t.input);let e="",s=!1,i=!1;this.input.on("keydown",t=>{e=this.input.val().toString(),h(t)===u.TAB?(this.results.length>0&&this.select(this.selected>=this.results.length-1?0:this.selected+1),t.preventDefault(),t.stopPropagation()):s!==t.shiftKey&&null!==this.criteria&&(s=!!t.shiftKey,this.search(this.criteria,s))}),this.input.on("keypress",t=>{const e=h(t),s=String.fromCharCode(e)||"";if(e===u.ENTER)K(this),this.reset();else if(s.length>0){K(this);const t=this.input.val().toString(),e=this.input[0].selectionStart+1,n=j(t.substring(0,e)+s+t.substring(e),e);this.search(n),this.results.length>0&&this.results[0].data===n.word&&(this.selected=0,_(this),X(this)),i=!0}}),this.input.on("keyup",t=>{const n=h(t);if(n!==u.TAB&&n!==u.ENTER){const n=this.input.val().toString();if(0===n.trim().length)this.reset();else if(i||n===e)s!==t.shiftKey&&null!==this.criteria&&(s=!!t.shiftKey,this.search(this.criteria,s));else{const t=j(n,this.input[0].selectionStart);this.search(t)}}i=!1,e=""}),this.input.on("mouseup",()=>{if(this.input[0].selectionStart!==this.input[0].selectionEnd)return this.reset();const t=j(this.input.val().toString(),this.input[0].selectionStart);this.search(t)})}search(t,e=!1){if(this.selected=-1,this.results=[],this.criteria=t,t.word.length>=$){const s=this.buckets.get(Y(t.word))||new Map,i=new RegExp("^"+Bt.makeSafeForRegex(t.pre),"i");this.results=[...s.values()].filter(s=>(!s.isemote||!(t.useronly||e))&&i.test(s.data)).sort(W).slice(0,V)}var s;(s=this).results.length>0&&(s.container[0].innerHTML=s.results.map((t,e)=>`<li data-index="${e}">${t.data}</li>`).join("")),X(this),function(t){x&&clearTimeout(x),x=setTimeout(()=>t.reset(),15e3,t)}(this)}reset(){this.criteria=null,this.results=[],this.selected=-1,X(this)}add(t,e=!1,s=1){const i=Y(t),n=this.buckets.get(i)||this.buckets.set(i,new Map).get(i),o=Object.assign(n.get(t)||{},{data:t,weight:s,isemote:e});return n.set(t,o),o}remove(t,e=!1){const s=this.buckets.get(Y(t));if(s&&s.has(t)){const i=s.get(t);(e&&!i.isemote||!e)&&s.delete(t)}}select(t){this.selected=Math.min(t,this.results.length-1);const e=this.results[this.selected];if(!e)return;let s=this.criteria.orig.substr(0,this.criteria.startCaret),i=this.criteria.orig.substr(this.criteria.startCaret+this.criteria.word.length);" "===i[0]&&0!==i.length||(i=" "+i),this.input.focus().val(s+e.data+i);const n=s.length+e.data.length+1;this.input[0].setSelectionRange(n,n),_(this),X(this)}};const Z=window.localStorage||{setItem:()=>{},getItem:()=>{}},z=window.JSON;var q=class{static write(t,e){let s="";try{s=z.stringify(e instanceof Map||e instanceof Set?[...e]:e)}catch(t){console.error(t)}Z.setItem(t,s)}static read(t){let e=null;try{e=z.parse(Z.getItem(t))}catch(t){console.error(t)}return e}static remove(t){try{Z.removeItem(t)}catch(t){console.error(t)}}};var Q=class{constructor(t){this.input=t.input,this.history=q.read("chat.history")||[],this.index=-1,this.lastinput="",this.maxentries=20,this.input.on("keydown",t=>{t.shiftKey||t.metaKey||t.ctrlKey||!c(t,u.UP)&&!c(t,u.DOWN)?this.index=-1:(this.show(c(t,u.UP)?-1:1),t.preventDefault(),t.stopPropagation())})}show(t){if(this.index<0){if(-1!==t)return;if(this.index=this.history.length,this.lastinput=this.input.val().toString(),this.index<=0)return}const e=this.index+t;let s=this.lastinput;e>=this.history.length||e<0?e>=this.history.length&&(this.index=-1):(this.index=e,s=this.history[e]),this.input.val(s)}add(t){this.index=-1,this.history.length>0&&this.history[this.history.length-1]===t||(this.history.push(t),this.history.length>this.maxentries&&this.history.slice(-this.maxentries),q.write("chat.history",this.history))}};var tt=class{constructor(t,e){this.chat=t,this.css=e,this.focused=[],this.chat.output.on("mousedown",t=>this.toggleElement(t.target))}toggleElement(t){const e=a()(t);e.hasClass("chat-user")?(this.chat.settings.get("focusmentioned")||this.toggleFocus(e.closest(".msg-user").data("username"),!0),this.toggleFocus(e.text())):e.hasClass("user")?this.toggleFocus(e.text()):this.focused.length>0&&this.clearFocus()}toggleFocus(t,e=null){t=(t||"").toLowerCase();const s=this.focused.indexOf(t.toLowerCase()),i=-1!==s;return null===e&&(e=!i),e&&!i?this.addCssRule(t):!e&&i&&this.removeCssRule(s),this}addCssRule(t){let e;e=this.chat.settings.get("focusmentioned")?`.msg-user[data-username="${t}"],.msg-user[data-mentioned~="${t}"]{opacity:1 !important;}`:`.msg-user[data-username="${t}"]{opacity:1 !important;}`,this.css.insertRule(e,this.focused.length),this.focused.push(t),this.redraw()}removeCssRule(t){this.css.deleteRule(t),this.focused.splice(t,1),this.redraw()}clearFocus(){this.focused.forEach(t=>this.css.deleteRule(0)),this.focused=[],this.redraw()}redraw(){this.chat.ui.toggleClass("focus-user",this.focused.length>0)}};var et={upgrade:function(t,e,s){if(e<=0){let e=q.read("chatoptions");e&&Object.keys(e).forEach(s=>{switch(s){case"highlightnicks":t.settings.set("highlightnicks",Object.keys(e[s]));break;default:t.settings.set(s,e[s])}}),e=q.read("chatignorelist"),e&&t.settings.set("ignorenicks",Object.keys(e)||[]),e=q.read("chat.ignoring"),e&&t.settings.set("ignorenicks",e),e=q.read("inputhistory"),e&&q.write("chat.history",e),e=t.settings.get("allowNotifications"),null!=e&&(t.settings.set("notificationwhisper",e),t.settings.set("notificationhighlight",e),t.settings.delete("allowNotifications")),e=t.settings.get("notificationtimeout"),t.settings.set("notificationtimeout",-1!==e),e=null,q.remove("chatoptions"),q.remove("inputhistory"),q.remove("chatignorelist"),q.remove("hiddenhints"),q.remove("lasthinttime"),q.remove("unreadMessageCount"),q.remove("chat.shownhints"),q.remove("chat.ignoring")}if(e<=1){let e=!0===t.settings.get("showremoved")?1:0;t.settings.set("showremoved",e)}}};const st=["green","yellow","orange","purple","blue","sky","lime","pink"];var it=class extends A{constructor(t,e="",s=""){super(),this.name=t,this.label=s,this.maxlines=0,this.linecount=0,this.locks=0,this.waspinned=!0,this.scrollplugin=null,this.visible=!1,this.tag=null,this.lastmessage=null,this.ui=a()(`<div id="chat-win-${t}" class="chat-output ${e} nano" style="display: none;">`+'<div class="chat-lines nano-content"></div><div class="chat-scroll-notify">More messages below</div></div>'),this.lines=this.ui.find(".chat-lines")}destroy(){return this.ui.remove(),this.scrollplugin.destroy(),this}into(t){const e=this.name.toLowerCase();return this.maxlines=t.settings.get("maxlines"),this.scrollplugin=new b(t,this.ui),this.tag=t.taggednicks.get(e)||st[Math.floor(Math.random()*st.length)],t.output.append(this.ui),t.addWindow(e,this),this}show(){this.visible||(this.visible=!0,this.emit("show"),this.ui.show())}hide(){this.visible&&(this.visible=!1,this.emit("hide"),this.ui.hide())}addMessage(t,e){e.ui=a()(e.html(t)),e.afterRender(t),this.lastmessage=e,this.lines.append(e.ui),this.linecount++,this.cleanup()}getlines(t){return this.lines.children(t)}removelines(t){const e=this.lines.children(t);this.linecount-=e.length,e.remove()}locked(){return this.locks>0}lock(){this.locks++,1===this.locks&&(this.waspinned=this.scrollplugin.isPinned())}unlock(){this.locks--,0===this.locks&&this.scrollplugin.updateAndPin(this.waspinned)}cleanup(){if(this.scrollplugin.isPinned()||this.waspinned){const t=this.lines.children();if(t.length>=this.maxlines){const e=t.slice(0,t.length-this.maxlines);this.linecount-=e.length,e.remove()}}}updateAndPin(t=!0){this.scrollplugin.updateAndPin(t)}};const nt=/^\/vote /i,ot=/^\/votestop/i,at=/\bor\b/i,rt=/^(how|why|when|what|where)\b/i,ut=/\b([0-9]+(?:m|s)?)$/i,ht=3e4,ct=6e5,lt=5e3;function dt(t){let e;const s=t.match(ut);if(s&&s[0])switch(t=t.replace(ut,""),s[0].replace(/[0-9]+/,"").toLowerCase()){case"s":e=1e3*parseInt(s[0]);break;case"m":e=60*parseInt(s[0])*1e3;break;default:e=ht}else e=ht;const i=function(t){if(-1===t.indexOf("?"))throw"Must contain a ?";const e=t.split("?"),s=e[0]+"?";if(""!==e[1].trim()){const t=e[1].split(at).map(t=>t.trim());if(t.length<2&&s.match(rt))throw"question needs at least 2 available answers";return{question:s,options:t}}return{question:s,options:["Yes","No"]}}(t.trim());return i.time=Math.max(lt,Math.min(e,ct)),i}var mt=class{constructor(t,e){this.chat=t,this.ui=e,this.vote=null,this.voting=!1,this.hidden=!0,this.timerHeartBeat=-1,this.timerEndVote=-1,this.timerHideVote=-1,this.ui.on("click touch",".vote-close",()=>this.hide()),this.ui.on("click touch",".opt",t=>{this.voting&&this.chat.cmdSEND(a()(t.currentTarget).index()+1+"")}),this.throttleVoteCast=Object(l.b)(100,!1,()=>{this.updateBars()})}hide(){this.hidden||(this.hidden=!0,this.chat.mainwindow.lock(),this.ui.removeClass("active"),this.chat.mainwindow.unlock())}show(){this.hidden&&(this.hidden=!1,this.chat.mainwindow.lock(),this.ui.addClass("active"),this.chat.mainwindow.unlock())}isVoteStarted(){return this.voting}canUserStartVote(t){return t.hasAnyFeatures(D.a.ADMIN,D.a.BOT,D.a.PROTECTED,D.a.MODERATOR)}isMsgVoteStopFmt(t){return t.match(ot)}isMsgVoteStartFmt(t){return t.match(nt)}isMsgVoteCastFmt(t){if(1===t.length&&t.match(/[0-9]/i)){const e=parseInt(t);return e>0&&e<=this.vote.question.options.length}return!1}canVote(t){return!this.vote.votes.has(t)}castVote(t,e){return!(!this.voting||this.hidden||!this.canVote(e))&&(this.vote.votes.set(e,t),this.vote.totals[t-1]++,this.throttleVoteCast(t),!0)}startVote(t,e){try{this.voting=!0,clearTimeout(this.timerEndVote),clearTimeout(this.timerHideVote),clearInterval(this.timerHeartBeat);const s=dt(t);this.vote={start:new Date,time:s.time,question:s,totals:s.options.map(()=>0),votes:new Map,user:e};const i=this.buildVoteFrame();return this.ui.vote=i,this.ui.label=i.find(".vote-label"),this.ui.bars=i.find(".opt").toArray().map(t=>{const e=a()(t),s=e.find(".opt-bar-value"),i=e.find(".opt-bar-inner");return{opt:e,barInner:i,barValue:s}}),this.chat.mainwindow.lock(),this.ui.empty().append(i),this.chat.mainwindow.unlock(),this.updateTimers(),this.updateBars(),this.show(),this.timerHeartBeat=setInterval(()=>this.updateTimers(),1e3),this.timerEndVote=setTimeout(()=>this.endVote(),this.vote.time),!0}catch(t){return console.error(t),this.voting=!1,!1}}endVote(){this.voting=!1,clearTimeout(this.timerEndVote),clearTimeout(this.timerHideVote),clearInterval(this.timerHeartBeat);const t=this.vote.totals.reduce((t,e,s,i)=>e>i[t]?s:t,0),e=this.ui.vote.find(".opt-options"),s=this.ui.vote.find(".opt-choices");e.find(`.opt:nth-child(${t+1})`).addClass("opt-winner"),s.find(`.opt-choice:nth-child(${t+1})`).addClass("opt-winner"),this.ui.label.html(`Vote ended! ${this.vote.votes.size} votes cast.`),this.ui.vote.addClass("vote-completed"),this.timerHideVote=setTimeout(()=>this.hide(),7e3),this.vote=null}markVote(t,e){this.ui.vote.find(`.opt-options .opt:nth-child(${t})`).addClass("opt-marked")}updateTimers(){const t=Math.floor(Math.min((this.vote.time-(new Date-this.vote.start))/1e3+1,this.vote.time/1e3));this.ui.label.html(`(Type in chat to participate) Started by ${this.vote.user} ending in ${t} ${t>1?"seconds":"second"}!`)}updateBars(){this.vote&&this.vote.question&&this.vote.question.options.forEach((t,e)=>{const s=this.vote.votes.size>0?this.vote.totals[e]/this.vote.votes.size*100:0;this.ui.bars[e].barInner.css("width",s+"%"),this.ui.bars[e].barValue.text(s>0?Math.round(s)+"%":"")})}buildVoteFrame(){const t=this.vote.question,e=a()("<span />").text(t.question)[0],s=t.options.map((t,e)=>{return`<span class="opt-choice"><strong>${e+1}</strong> ${a()("<span/>").text(t)[0].outerHTML}</span>`}).join(" ");return a()('<div class="vote-frame"><div class="vote-header"><label class="vote-question">'+e.outerHTML+`<span class="opt-choices">${s}</span>`+'</label><label class="vote-close" title="Close"></label></div><div class="opt-options">'+t.options.reduce((t,e,s)=>(t+='<div class="opt" title="Vote">',t+=`<div class="opt-info"><strong>${s+1}</strong></div>`,t+='<div class="opt-bar"><div class="opt-bar-inner" style="width: 0;"><span class="opt-bar-value">0</span></div></div>',t+="</div>"),"")+'</div><label class="vote-label"></label></div>')}};const At=/^\/([a-z0-9]+)[\s]?/i,gt=/(\d+(?:\.\d*)?)([a-z]+)?/gi,Et=/[\-\[\]\/{}()*+?.\\^$|]/g,pt=/(?:(?:^|\s)@?)([a-zA-Z0-9_]{3,20})(?=$|\s|[.?!,])/g,Ct=/^[a-zA-Z0-9_]{3,20}$/,ft=new RegExp("\\b(?:NSFL|NSFW)\\b","i"),St=new RegExp("\\b(?:NSFW)\\b","i"),Tt=new RegExp("\\b(?:NSFL)\\b","i"),It=["green","yellow","orange","red","purple","blue","sky","lime","pink","black"],Ot=new Map([["unknown","Unknown error, this usually indicates an internal problem :("],["nopermission","You do not have the required permissions to use that"],["protocolerror","Invalid or badly formatted"],["needlogin","You have to be logged in to use that"],["invalidmsg","The message was invalid"],["throttled","Throttled! You were trying to send messages too fast"],["duplicate","The message is identical to the last one you sent"],["muted","You are muted (mutes are always temporary). Subscribing removes mutes: Check your profile for more information."],["submode","The channel is currently in subscriber only mode"],["needbanreason","Providing a reason for the ban is mandatory"],["banned","You have been banned (subscribing removes non-permanent bans). Check your profile for more information."],["privmsgbanned","Cannot send private messages while banned"],["requiresocket","This chat requires WebSockets"],["toomanyconnections","Only 5 concurrent connections allowed"],["socketerror","Error contacting server"],["privmsgaccounttooyoung","Your account is too recent to send private messages"],["notfound","The user was not found"],["notconnected","You have to be connected to use that"]]),Nt=new Map([["slashhelp","Type in /help for more a list of commands, do advanced things like modify your scroll-back size"],["tabcompletion","Use the tab key to auto-complete names and emotes (for user only completion prepend a @ or press shift)"],["hoveremotes","Hovering your mouse over an emote will show you the emote code"],["highlight","Chat messages containing your username will be highlighted"],["notify","Use /msg <username> to send a private message to someone"],["ignoreuser","Use /ignore <username> to hide messages from pesky chatters"],["mutespermanent","Mutes are never persistent, don't worry it will pass!"],["tagshint",`Use the /tag <nick> [<color> <note>] to tag users you like. There are preset colors to choose from ${It.join(", ")}`],["bigscreen","Bigscreen! Did you know you can have the chat on the left or right side of the stream by clicking the swap icon in the top left?"]]),wt=new Map([["schemaversion",2],["showtime",!1],["hideflairicons",!1],["profilesettings",!1],["timestampformat","HH:mm"],["maxlines",250],["notificationwhisper",!1],["notificationhighlight",!1],["highlight",!0],["customhighlight",[]],["highlightnicks",[]],["taggednicks",[]],["taggednotes",[]],["showremoved",0],["showhispersinchat",!1],["ignorenicks",[]],["focusmentioned",!1],["notificationtimeout",!0],["ignorementions",!1],["autocompletehelper",!0],["taggedvisibility",!1],["hidensfw",!1],["hidensfl",!1],["fontscale","auto"]]),Rt=new Map([["help",{desc:"Helpful information."}],["emotes",{desc:"A list of the chats emotes in text form."}],["me",{desc:"A normal message, but emotive."}],["message",{desc:"Whisper someone",alias:["msg","whisper","w","tell","t","notify"]}],["ignore",{desc:"No longer see user messages, without <nick> to list the nicks ignored"}],["unignore",{desc:"Remove a user from your ignore list"}],["highlight",{desc:"Highlights target nicks messages for easier visibility"}],["unhighlight",{desc:"Unhighlight target nick"}],["maxlines",{desc:"The maximum number of lines the chat will store"}],["mute",{desc:"The users messages will be blocked from everyone.",admin:!0}],["unmute",{desc:"Unmute the user.",admin:!0}],["subonly",{desc:"Subscribers only",admin:!0}],["ban",{desc:"User will no longer be able to connect to the chat.",admin:!0}],["unban",{desc:"Unban a user",admin:!0}],["timestampformat",{desc:"Set the time format of the chat."}],["tag",{desc:"Mark a users messages"}],["untag",{desc:"No longer mark the users messages"}],["exit",{desc:"Exit the conversation you are in."}],["reply",{desc:"Reply to the last private message.",alias:["r"]}],["stalk",{desc:"Return a list of messages from <nick>",alias:["s"]}],["mentions",{desc:"Return a list of messages where <nick> is mentioned",alias:["m"]}],["vote",{desc:"Start a vote."}],["votestop",{desc:"Stop a vote you started."}]]),Ft={id:0,userid:0,username:"",targetuserid:"",targetusername:"",ipaddress:"",reason:"",starttimestamp:"",endtimestamp:""};class vt{constructor(t){return this.config=Object.assign({},{url:"",api:{base:""},cdn:{base:""},cacheKey:""},t),this.ui=null,this.css=null,this.output=null,this.input=null,this.loginscrn=null,this.loadingscrn=null,this.showmotd=!0,this.authenticated=!1,this.backlogloading=!1,this.unresolved=[],this.flairs=new Set,this.emotes=new Set,this.flairsMap=new Map,this.emotesMap=new Map,this.emotePrefixes=new Set,this.emoteRegexNormal=null,this.emoteRegexTwitch=null,this.user=new p,this.users=new Map,this.whispers=new Map,this.windows=new Map,this.settings=new Map(wt),this.autocomplete=new J,this.menus=new Map,this.taggednicks=new Map,this.taggednotes=new Map,this.ignoring=new Set,this.mainwindow=null,this.regexhighlightcustom=null,this.regexhighlightnicks=null,this.regexhighlightself=null,this.replyusername=null,this.control=new A(this),this.source=new E,this.source.on("REFRESH",()=>window.location.reload(!1)),this.source.on("PING",t=>this.source.send("PONG",t)),this.source.on("CONNECTING",t=>this.onCONNECTING(t)),this.source.on("OPEN",t=>this.onOPEN(t)),this.source.on("DISPATCH",t=>this.onDISPATCH(t)),this.source.on("CLOSE",t=>this.onCLOSE(t)),this.source.on("NAMES",t=>this.onNAMES(t)),this.source.on("QUIT",t=>this.onQUIT(t)),this.source.on("MSG",t=>this.onMSG(t)),this.source.on("MUTE",t=>this.onMUTE(t)),this.source.on("UNMUTE",t=>this.onUNMUTE(t)),this.source.on("BAN",t=>this.onBAN(t)),this.source.on("UNBAN",t=>this.onUNBAN(t)),this.source.on("ERR",t=>this.onERR(t)),this.source.on("SOCKETERROR",t=>this.onSOCKETERROR(t)),this.source.on("SUBONLY",t=>this.onSUBONLY(t)),this.source.on("BROADCAST",t=>this.onBROADCAST(t)),this.source.on("PRIVMSGSENT",t=>this.onPRIVMSGSENT(t)),this.source.on("PRIVMSG",t=>this.onPRIVMSG(t)),this.control.on("SEND",t=>this.cmdSEND(t)),this.control.on("HINT",t=>this.cmdHINT(t)),this.control.on("EMOTES",t=>this.cmdEMOTES(t)),this.control.on("HELP",t=>this.cmdHELP(t)),this.control.on("IGNORE",t=>this.cmdIGNORE(t)),this.control.on("UNIGNORE",t=>this.cmdUNIGNORE(t)),this.control.on("MUTE",t=>this.cmdMUTE(t)),this.control.on("BAN",t=>this.cmdBAN(t,"BAN")),this.control.on("IPBAN",t=>this.cmdBAN(t,"IPBAN")),this.control.on("UNMUTE",t=>this.cmdUNBAN(t,"UNMUTE")),this.control.on("UNBAN",t=>this.cmdUNBAN(t,"UNBAN")),this.control.on("SUBONLY",t=>this.cmdSUBONLY(t,"SUBONLY")),this.control.on("MAXLINES",t=>this.cmdMAXLINES(t,"MAXLINES")),this.control.on("UNHIGHLIGHT",t=>this.cmdHIGHLIGHT(t,"UNHIGHLIGHT")),this.control.on("HIGHLIGHT",t=>this.cmdHIGHLIGHT(t,"HIGHLIGHT")),this.control.on("TIMESTAMPFORMAT",t=>this.cmdTIMESTAMPFORMAT(t)),this.control.on("BROADCAST",t=>this.cmdBROADCAST(t)),this.control.on("CONNECT",t=>this.cmdCONNECT(t)),this.control.on("TAG",t=>this.cmdTAG(t)),this.control.on("UNTAG",t=>this.cmdUNTAG(t)),this.control.on("BANINFO",t=>this.cmdBANINFO(t)),this.control.on("EXIT",t=>this.cmdEXIT(t)),this.control.on("MESSAGE",t=>this.cmdWHISPER(t)),this.control.on("MSG",t=>this.cmdWHISPER(t)),this.control.on("WHISPER",t=>this.cmdWHISPER(t)),this.control.on("W",t=>this.cmdWHISPER(t)),this.control.on("TELL",t=>this.cmdWHISPER(t)),this.control.on("T",t=>this.cmdWHISPER(t)),this.control.on("NOTIFY",t=>this.cmdWHISPER(t)),this.control.on("R",t=>this.cmdREPLY(t)),this.control.on("REPLY",t=>this.cmdREPLY(t)),this.control.on("MENTIONS",t=>this.cmdMENTIONS(t)),this.control.on("M",t=>this.cmdMENTIONS(t)),this.control.on("STALK",t=>this.cmdSTALK(t)),this.control.on("S",t=>this.cmdSTALK(t)),this.control.on("VOTE",t=>this.cmdVOTE(t)),this.control.on("V",t=>this.cmdVOTE(t)),this.control.on("VOTESTOP",t=>this.cmdVOTESTOP(t)),this.control.on("VS",t=>this.cmdVOTESTOP(t)),this}setUser(t){return t&&""!==t.username?(this.user=this.addUser(t),this.authenticated=!0):(this.user=this.addUser({nick:"User"+Math.floor(9e4*Math.random())+1e4}),this.authenticated=!1),this.authenticated&&this.input.focus().attr("placeholder",`Write something ${this.user.username} ...`),this}setSettings(t){let e=null!==t&&this.authenticated&&t.get("profilesettings")?t:new Map(q.read("chat.settings")||[]);e.size>0&&[...this.settings.keys()].filter(t=>void 0!==e.get(t)&&null!==e.get(t)).forEach(t=>this.settings.set(t,e.get(t)));const s=e.has("schemaversion")?parseInt(e.get("schemaversion")):-1,i=wt.get("schemaversion");return-1!==s&&i>s&&(et.upgrade(this,s,i),this.settings.set("schemaversion",i),this.saveSettings()),this.taggednicks=new Map(this.settings.get("taggednicks")),this.taggednotes=new Map(this.settings.get("taggednotes")),this.ignoring=new Set(this.settings.get("ignorenicks")),this.applySettings(!1)}withGui(t,e=null){this.ui=a()(t),this.ui.prependTo(e||"body"),this.css=(()=>{const t=document.createElement("style");return t.id="chat-styles",t.type="text/css",document.getElementsByTagName("head")[0].appendChild(t),t.sheet})(),this.ishidden="visible"!==(document.visibilityState||"visible"),this.output=this.ui.find("#chat-output-frame"),this.input=this.ui.find("#chat-input-control"),this.loginscrn=this.ui.find("#chat-login-screen"),this.loadingscrn=this.ui.find("#chat-loading"),this.windowselect=this.ui.find("#chat-windows-select"),this.inputhistory=new Q(this),this.userfocus=new tt(this,this.css),this.mainwindow=new it("main").into(this),this.ui.find("#chat-vote-frame:first").each((t,e)=>{this.chatvote=new mt(this,a()(e))}),this.windowToFront("main"),this.menus.set("settings",new y(this.ui.find("#chat-settings"),this.ui.find("#chat-settings-btn"),this)),this.menus.set("emotes",new H(this.ui.find("#chat-emote-list"),this.ui.find("#chat-emoticon-btn"),this)),this.menus.set("users",new P(this.ui.find("#chat-user-list"),this.ui.find("#chat-users-btn"),this)),this.menus.set("whisper-users",new G(this.ui.find("#chat-whisper-users"),this.ui.find("#chat-whisper-btn"),this)),Rt.forEach((t,e)=>{this.autocomplete.add(`/${e}`),(t.alias||[]).forEach(t=>this.autocomplete.add(`/${t}`))}),this.autocomplete.bind(this),this.input.on("keypress",t=>{!c(t,u.ENTER)||t.shiftKey||t.ctrlKey||(t.preventDefault(),t.stopPropagation(),this.control.emit("SEND",this.input.val().toString().trim()),this.input.focus())});let s=!1;this.output.on("mousedown",()=>s=!0),this.output.on("mouseup",()=>{s&&(s=!1,U.closeMenus(this),this.focusIfNothingSelected())}),this.ui.on("click","#chat-tools-wrap",()=>{U.closeMenus(this),this.focusIfNothingSelected()}),document.addEventListener("keydown",t=>{c(t,u.ESC)&&U.closeMenus(this)}),document.addEventListener("visibilitychange",Object(l.a)(100,!1,()=>{this.ishidden="visible"!==(document.visibilityState||"visible"),this.ishidden?U.closeMenus(this):this.focusIfNothingSelected()}),!0);let i=!1;const n=Object(l.a)(100,!1,()=>{i=!1,this.getActiveWindow().unlock(),this.focusIfNothingSelected()});return window.addEventListener("resize",()=>{i||(i=!0,U.closeMenus(this),this.getActiveWindow().lock()),n()},!1),this.windowselect.on("click",".tab-close",t=>(U.closeMenus(this),this.removeWindow(a()(t.currentTarget).parent().data("name").toLowerCase()),this.input.focus(),!1)),this.windowselect.on("click",".tab",t=>(U.closeMenus(this),this.windowToFront(a()(t.currentTarget).data("name").toLowerCase()),this.input.focus(),!1)),this.output.on("click",".censored",t=>{const e=a()(t.currentTarget).closest(".msg-user").data("username");return this.getActiveWindow().getlines(`.censored[data-username="${e}"]`).removeClass("censored"),!1}),this.loginscrn.on("click","#chat-btn-login",()=>{this.loginscrn.hide();try{window.top.showLoginModal()}catch(t){const e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");try{return window.self===window.top?window.location.href=e+"/login?follow="+encodeURIComponent(window.location.pathname):window.location.href=e+"/login",!1}catch(t){}window.location.href=e+"/login"}return!1}),this.loginscrn.on("click","#chat-btn-cancel",()=>this.loginscrn.hide()),this.output.on("click mousedown",".msg-whisper a.user",t=>{const e=a()(t.target).closest(".msg-chat");return this.openConversation(e.data("username").toString().toLowerCase()),!1}),this.loadingscrn.fadeOut(250,()=>this.loadingscrn.remove()),this.mainwindow.updateAndPin(),this.input.focus().attr("placeholder","Write something ..."),O.status("Welcome to DGG chat").into(this),Promise.resolve(this)}connect(){this.source.connect(this.config.url)}async loadUserAndSettings(){return Object(i.a)(`${this.config.api.base}/api/chat/me`,{credentials:"include"}).then(t=>t.json()).then(t=>{this.setUser(t),this.setSettings(new Map(t.settings))}).catch(()=>{this.setUser(null),this.setSettings()})}async loadEmotesAndFlairs(){await this.loadEmotes(),await this.loadFlairs()}async loadEmotes(){return vt.loadCss(`${this.config.cdn.base}/emotes/emotes.css?_=${this.config.cacheKey}`),Object(i.a)(`${this.config.cdn.base}/flairs/flairs.json?_=${this.config.cacheKey}`).then(t=>t.json()).then(t=>{this.setFlairs(t)}).catch(()=>{})}async loadFlairs(){return vt.loadCss(`${this.config.cdn.base}/flairs/flairs.css?_=${this.config.cacheKey}`),Object(i.a)(`${this.config.cdn.base}/emotes/emotes.json?_=${this.config.cacheKey}`).then(t=>t.json()).then(t=>{this.setEmotes(t)}).catch(()=>{})}async loadHistory(){return Object(i.a)(`${this.config.api.base}/api/chat/history`).then(t=>t.json()).then(t=>{this.setHistory(t)}).catch(()=>{})}async loadWhispers(){if(this.authenticated)return Object(i.a)(`${this.config.api.base}/api/messages/unread`,{credentials:"include"}).then(t=>t.json()).then(t=>{t.forEach(t=>this.whispers.set(t.username.toLowerCase(),{id:t.messageid,nick:t.username,unread:t.unread,open:!1}))}).then(()=>this.menus.get("whisper-users").redraw()).catch(()=>{})}setEmotes(t){this.emotes=t,this.emotesMap=new Map,t.forEach(t=>this.emotesMap.set(t.prefix,t));const e=t.filter(t=>!t.twitch).map(t=>t.prefix).join("|"),s=t.filter(t=>t.twitch).map(t=>t.prefix).join("|");return this.emoteRegexNormal=new RegExp(`(^|\\s)(${e})(?=$|\\s)`,"gm"),this.emoteRegexTwitch=new RegExp(`(^|\\s)(${e}|${s})(?=$|\\s)`,"gm"),this.emotePrefixes=new Set([...t.map(t=>t.prefix)]),this.emotePrefixes.forEach(t=>this.autocomplete.add(t,!0)),this}setFlairs(t){return this.flairs=t,this.flairsMap=new Map,t.forEach(t=>this.flairsMap.set(t.name,t)),this}setHistory(t){return t&&t.length>0&&(this.backlogloading=!0,t.forEach(t=>this.source.parseAndDispatch({data:t})),this.backlogloading=!1,O.element("<hr/>").into(this),this.mainwindow.updateAndPin()),this}saveSettings(){this.authenticated&&this.settings.get("profilesettings")?Object(i.a)(`${this.config.api.base}/api/chat/me/settings`,{body:JSON.stringify([...this.settings]),credentials:"include",method:"POST"}).catch(console.warn):q.write("chat.settings",this.settings)}commitSettings(){this.debouncedsave||(this.debouncedsave=Object(l.a)(1e3,!1,()=>this.saveSettings())),this.debouncedsave()}applySettings(t=!0){t&&this.saveSettings(),r.TIME=this.settings.get("timestampformat");const e=Array.from(this.ignoring.values()).map(vt.makeSafeForRegex);this.ignoreregex=e.length>0?new RegExp(`\\b(?:${e.join("|")})\\b`,"i"):null;const s=[...this.settings.get("customhighlight")||[]].filter(t=>""!==t),i=[...this.settings.get("highlightnicks")||[]].filter(t=>""!==t);this.regexhighlightself=this.user.nick?new RegExp(`\\b(?:${this.user.nick})\\b`,"i"):null,this.regexhighlightcustom=s.length>0?new RegExp(`\\b(?:${s.join("|")})\\b`,"i"):null,this.regexhighlightnicks=i.length>0?new RegExp(`\\b(?:${i.join("|")})\\b`,"i"):null,Array.from(this.settings.keys()).filter(t=>"boolean"==typeof this.settings.get(t)).forEach(t=>this.ui.toggleClass(`pref-${t}`,this.settings.get(t))),[...this.windows.values()].forEach(t=>t.maxlines=this.settings.get("maxlines"));const n=this.settings.get("fontscale")||"auto";return a()(document.body).toggleClass("pref-fontscale","auto"!==n),a()(document.body).attr("data-fontscale",n),Promise.resolve(this)}addUser(t){if(!t)return null;const e=t.nick.toLowerCase();let s=this.users.get(e);return s?t.hasOwnProperty("features")&&!vt.isArraysEqual(t.features,s.features)&&(s.features=t.features):(s=new p(t),this.users.set(e,s)),s}addMessage(t,e=null){if(t.type!==f.USER||!this.ignored(t.user.nick,t.message))return null===e&&(e=this.mainwindow),e.lock(),e.lastmessage&&e.lastmessage.type===f.EMOTE&&e.lastmessage.emotecount>1&&e.lastmessage.completeCombo(),t.type===f.USER&&(t.slashme="/me "===t.message.substring(0,4).toLowerCase(),t.isown=t.user.username.toLowerCase()===this.user.username.toLowerCase(),t.continued=e.lastmessage&&!e.lastmessage.target&&e.lastmessage.user&&e.lastmessage.user.username.toLowerCase()===t.user.username.toLowerCase(),t.mentioned=vt.extractNicks(t.message).filter(t=>this.users.has(t.toLowerCase())),t.tag=this.taggednicks.get(t.user.nick.toLowerCase()),t.title=this.taggednotes.get(t.user.nick.toLowerCase())||"",t.highlighted=!t.isown&&(this.regexhighlightself&&this.settings.get("highlight")&&this.regexhighlightself.test(t.message)||this.regexhighlightnicks&&this.regexhighlightnicks.test(t.user.username)||this.regexhighlightcustom&&this.regexhighlightcustom.test(t.user.username+" "+t.message))),e.addMessage(this,t),!this.backlogloading&&t.highlighted&&this.settings.get("notificationhighlight")&&this.ishidden&&vt.showNotification(`${t.user.username} said ...`,t.message,t.timestamp.valueOf(),this.settings.get("notificationtimeout")),e.unlock(),t}resolveMessage(t,e){for(const s of this.unresolved)if(this.user.username.toLowerCase()===t.toLowerCase()&&s.message===e)return this.unresolved.splice(this.unresolved.indexOf(s),1),!0;return!1}removeMessageByNick(t){this.mainwindow.lock(),this.mainwindow.removelines(`.msg-chat[data-username="${t.toLowerCase()}"]`),this.mainwindow.unlock()}windowToFront(t){const e=this.windows.get(t);return null!==e&&e!==this.getActiveWindow()&&(this.windows.forEach(t=>{t.visible&&(t.locked()||t.lock(),t.hide())}),e.show(),e.locked()&&e.unlock(),this.redrawWindowIndicators()),e}getActiveWindow(){return[...this.windows.values()].filter(t=>t.visible)[0]}getWindow(t){return this.windows.get(t)}addWindow(t,e){this.windows.set(t,e),this.redrawWindowIndicators()}removeWindow(t){const e=this.windows.get(t);if(e){const s=e.visible;if(this.windows.delete(t),e.destroy(),s){const t=[...this.windows.keys()];this.windowToFront(this.windows.get(t[t.length-1]).name)}else this.redrawWindowIndicators()}}redrawWindowIndicators(){this.windows.size>1&&(this.windowselect.empty(),this.windows.forEach(t=>{if("main"===t.name)this.windowselect.append(`<span title="Destiny GG" data-name="main" class="tab win-main tag-${t.tag} ${t.visible?"active":""}"><i class="dgg-icon"></i></span>`);else{const e=this.whispers.get(t.name);this.windowselect.append(`<span title="${t.label}" data-name="${t.name}" class="tab win-${t.name} tag-${t.tag} ${t.visible?"active":""} ${e.unread>0?"unread":""}">\n                    <span>${t.label}${e.unread>0?" ("+e.unread+")":""}</span>\n                    <i class="tab-close" title="Close" />\n                    </span>`)}})),null!==this.mainwindow&&this.mainwindow.lock(),this.windowselect.toggle(this.windows.size>1),null!==this.mainwindow&&this.mainwindow.unlock()}censor(t){this.mainwindow.lock();const e=this.mainwindow.getlines(`.msg-chat[data-username="${t.toLowerCase()}"]`);switch(parseInt(this.settings.get("showremoved")||1)){case 0:e.remove();break;case 1:e.addClass("censored")}this.mainwindow.unlock()}ignored(t,e=null){let s=this.ignoring.has(t.toLowerCase());return s||null===e?s:this.settings.get("ignorementions")&&this.ignoreregex&&this.ignoreregex.test(e)||this.settings.get("hidensfw")&&this.settings.get("hidensfl")&&ft.test(e)||this.settings.get("hidensfl")&&Tt.test(e)||this.settings.get("hidensfw")&&St.test(e)}ignore(t,e=!0){t=t.toLowerCase();const s=this.ignoring.has(t);e&&!s?this.ignoring.add(t):!e&&s&&this.ignoring.delete(t),this.settings.set("ignorenicks",[...this.ignoring]),this.applySettings()}focusIfNothingSelected(){void 0===this.debounceFocus&&(this.debounceFocus=Object(l.a)(10,!1,t=>t.input.focus())),window.getSelection().isCollapsed&&!this.input.is(":focus")&&this.debounceFocus(this)}onDISPATCH({data:t}){if("object"==typeof t){let e=[];const s=Date.now();t.hasOwnProperty("nick")&&e.push(this.addUser(t)),t.hasOwnProperty("users")&&(e=e.concat(Array.from(t.users).map(t=>this.addUser(t)))),e.forEach(t=>this.autocomplete.add(t.nick,!1,s))}}onCLOSE({retryMilli:t}){t>0?O.error(`Disconnected, retry in ${Math.round(t/1e3)} seconds ...`).into(this):O.error("Disconnected.").into(this)}onCONNECTING(t){this.authenticated?O.status(`Connecting as ${this.user.username} to ${vt.extractHostname(t)} ...`).into(this):O.status(`Connecting to ${vt.extractHostname(t)} ...`).into(this)}onOPEN(){}onNAMES(t){O.status(`Connected. serving ${t.connectioncount||0} connections and ${t.users.length} users.`).into(this),this.showmotd&&(this.cmdHINT([Math.floor(Math.random()*Nt.size)]),this.showmotd=!1)}onQUIT(t){const e=t.nick.toLowerCase();this.users.has(e)&&(this.users.delete(e),this.autocomplete.remove(t.nick,!0))}onMSG(t){const e=vt.removeSlashCmdFromText(t.data),s=this.users.get(t.nick.toLowerCase());if(this.chatvote&&!this.backlogloading)if(this.chatvote.isVoteStarted()){if(this.chatvote.isMsgVoteStopFmt(t.data))return void(this.chatvote.vote.user===s.username&&this.chatvote.endVote());if(this.chatvote.isMsgVoteCastFmt(e))return void(this.chatvote.castVote(e,s.username)&&s.username===this.user.username&&this.chatvote.markVote(e,s.username))}else if(this.chatvote.isMsgVoteStartFmt(t.data)&&this.chatvote.canUserStartVote(s))return void(this.chatvote.startVote(e,s.username)?O.info(`A vote has been started. Type ${this.chatvote.vote.totals.map((t,e)=>e+1).join(" or ")} in chat to participate.`).into(this):this.user.username===s.username&&O.error("Your vote failed to start. See console for logs."));const i=this.mainwindow;null!==i.lastmessage&&this.emotePrefixes.has(e)&&vt.removeSlashCmdFromText(i.lastmessage.message)===e?i.lastmessage.type===f.EMOTE?(this.mainwindow.lock(),i.lastmessage.incEmoteCount(),this.mainwindow.unlock()):(i.lastmessage.ui.remove(),O.emote(e,t.timestamp,2).into(this)):this.resolveMessage(t.nick,t.data)||O.message(t.data,s,t.timestamp).into(this)}onMUTE(t){this.user.username.toLowerCase()===t.data.toLowerCase()?O.command(`You have been muted by ${t.nick}.`,t.timestamp).into(this):O.command(`${t.data} muted by ${t.nick}.`,t.timestamp).into(this),this.censor(t.data)}onUNMUTE(t){this.user.username.toLowerCase()===t.data.toLowerCase()?O.command(`You have been unmuted by ${t.nick}.`,t.timestamp).into(this):O.command(`${t.data} unmuted by ${t.nick}.`,t.timestamp).into(this)}onBAN(t){this.user.username.toLowerCase()===t.data.toLowerCase()?(O.command(`You have been banned by ${t.nick}. Check your profile for more information.`,t.timestamp).into(this),this.cmdBANINFO()):O.command(`${t.data} banned by ${t.nick}.`,t.timestamp).into(this),this.censor(t.data)}onUNBAN(t){this.user.username.toLowerCase()===t.data.toLowerCase()?O.command(`You have been unbanned by ${t.nick}.`,t.timestamp).into(this):O.command(`${t.data} unbanned by ${t.nick}.`,t.timestamp).into(this)}onERR(t){"toomanyconnections"!==t&&"banned"!==t||(this.source.retryOnDisconnect=!1),O.error(Ot.get(t)||t).into(this,this.getActiveWindow())}onSOCKETERROR(t){}onSUBONLY(t){const e="on"===t.data?"enabled":"disabled";O.command(`Subscriber only mode ${e} by ${t.nick}`,t.timestamp).into(this)}onBROADCAST(t){if("reload"===t.data){if(!this.backlogloading){const t=Math.floor(3e4*Math.random())+4e3;setTimeout(()=>window.location.reload(!0),t),O.broadcast(`Restart incoming in ${Math.round(t/1e3)} seconds ...`).into(this)}}else O.broadcast(t.data,t.timestamp).into(this)}onPRIVMSGSENT(){this.mainwindow.visible&&O.info("Your message has been sent.").into(this)}onPRIVMSG(t){const e=t.nick.toLowerCase();if(!this.ignored(e,t.data)){this.whispers.has(e)||this.whispers.set(e,{nick:t.nick,unread:0,open:!1});const s=this.whispers.get(e),n=this.users.get(e)||new p(t.nick),o=t.hasOwnProperty("messageid")?t.messageid:null;this.settings.get("showhispersinchat")&&O.whisper(t.data,n,this.user.username,t.timestamp,o).into(this),this.settings.get("notificationwhisper")&&this.ishidden&&vt.showNotification(`${t.nick} whispered ...`,t.data,t.timestamp,this.settings.get("notificationtimeout"));const a=this.getWindow(e);a&&O.historical(t.data,n,t.timestamp).into(this,a),a===this.getActiveWindow()?Object(i.a)(`${this.config.api.base}/api/messages/msg/${o}/open`,{credentials:"include",method:"POST"}).catch(console.warn):s.unread++,this.replyusername=n.username,this.menus.get("whisper-users").redraw(),this.redrawWindowIndicators()}}cmdSEND(t){if(""!==t){const e=this.getActiveWindow(),s=t.match(At),i=s&&s.length>1,n=i&&"me"===s[1].toLowerCase(),o=vt.removeSlashCmdFromText(t);if(i&&!n){const i=s[1].toUpperCase(),n=i.toUpperCase();if(this.inputhistory.add(t),this.input.val(""),e!==this.mainwindow&&"EXIT"!==n)O.error("No commands in private windows. Try /exit").into(this,e);else if(this.control.listeners.has(n)){const e=(t.substring(i.length+1)||"").match(/([^ ]+)/g);this.control.emit(n,e||[])}else O.error("Unknown command. Try /help").into(this,e)}else if(this.authenticated)if(e!==this.mainwindow)O.message(t,this.user).into(this,e),this.source.send("PRIVMSG",{nick:e.name,data:t}),this.input.val("");else if(this.chatvote.isVoteStarted()&&this.chatvote.isMsgVoteCastFmt(o))this.chatvote.canVote(this.user.username)?(O.info("Your vote has been cast!").into(this),this.source.send("MSG",{data:t}),this.input.val("")):(O.error("You have already voted!").into(this),this.input.val(""));else if(this.source.isConnected()&&this.emotePrefixes.has(o))this.source.send("MSG",{data:t}),this.inputhistory.add(t),this.input.val("");else{const e=O.message(t,this.user).into(this);this.unresolved.unshift(e),this.source.send("MSG",{data:t}),this.inputhistory.add(t),this.input.val("")}else this.loginscrn.show()}}cmdVOTE(t){if(this.chatvote.isVoteStarted())O.error("Vote already started.").into(this);else if(this.chatvote.canUserStartVote(this.user)){const e="/vote "+t.join(" ");this.unresolved.unshift(O.message(e,this.user)),this.source.send("MSG",{data:e})}else O.error("You do not have permission to start a vote.").into(this)}cmdVOTESTOP(){if(this.chatvote.isVoteStarted())if(this.chatvote.canUserStartVote(this.user)&&this.chatvote.vote.user===this.user.nick){const t="/votestop";this.unresolved.unshift(O.message(t,this.user)),this.source.send("MSG",{data:t})}else O.error("You do not have permission to stop this vote.").into(this);else O.error("No vote started.").into(this)}cmdEMOTES(){O.info(`Available emoticons: ${[...this.emotes.map(t=>t.prefix)].join(", ")}`).into(this)}cmdHELP(){let t="Available commands: \r";Rt.forEach((e,s)=>{t+=` /${s} - ${e.desc} \r`}),O.info(t).into(this)}cmdHINT(t){const e=[...Nt],s=t&&t[0]?parseInt(t[0])-1:-1;s>0&&s<Nt.size?O.info(e[s][1]).into(this):(void 0===this.lasthintindex||this.lasthintindex===e.length-1?this.lasthintindex=0:this.lasthintindex++,O.info(e[this.lasthintindex][1]).into(this))}cmdIGNORE(t){const e=t[0]||null;e?Ct.test(e)?(this.ignore(e,!0),this.removeMessageByNick(e),O.status(`Ignoring ${e}`).into(this)):O.info("Invalid nick - /ignore <nick>").into(this):this.ignoring.size<=0?O.info("Your ignore list is empty").into(this):O.info(`Ignoring the following people: ${Array.from(this.ignoring.values()).join(", ")}`).into(this)}cmdUNIGNORE(t){const e=t[0]||null;e&&Ct.test(e)?(this.ignore(e,!1),O.status(`${e} has been removed from your ignore list`).into(this)):O.error("Invalid nick - /ignore <nick>").into(this)}cmdMUTE(t){if(0===t.length)O.info("Usage: /mute <nick>[ <time>]").into(this);else if(Ct.test(t[0])){const e=t[1]?vt.parseTimeInterval(t[1]):null;e&&e>0?this.source.send("MUTE",{data:t[0],duration:e}):this.source.send("MUTE",{data:t[0]})}else O.info("Invalid nick - /mute <nick>[ <time>]").into(this)}cmdBAN(t,e){if(0===t.length||t.length<3)O.info(`Usage: /${e} <nick> <time> <reason> (time can be 'permanent')`).into(this);else if(Ct.test(t[0]))if(t[2]){let s={nick:t[0],reason:t.slice(2,t.length).join(" ")};"IPBAN"===e||/^perm/i.test(t[1])?s.ispermanent="IPBAN"===e||/^perm/i.test(t[1]):s.duration=vt.parseTimeInterval(t[1]),this.source.send("BAN",s)}else O.error("Providing a reason is mandatory").into(this);else O.info("Invalid nick").into(this)}cmdUNBAN(t,e){0===t.length?O.info(`Usage: /${e} nick`).into(this):Ct.test(t[0])?this.source.send(e,{data:t[0]}):O.info("Invalid nick").into(this)}cmdSUBONLY(t,e){/on|off/i.test(t[0])?this.source.send(e.toUpperCase(),{data:t[0].toLowerCase()}):O.error(`Invalid argument - /${e.toLowerCase()} on | off`).into(this)}cmdMAXLINES(t,e){if(0===t.length)return void O.info(`Maximum lines stored: ${this.settings.get("maxlines")}`).into(this);const s=Math.abs(parseInt(t[0],10));s?(this.settings.set("maxlines",s),this.applySettings(),O.info(`Set maximum lines to ${s}`).into(this)):O.info(`Invalid argument - /${e} is expecting a number`).into(this)}cmdHIGHLIGHT(t,e){const s=this.settings.get("highlightnicks");if(0===t.length)return void(s.length>0?O.info("Currently highlighted users: "+s.join(",")).into(this):O.info("No highlighted users").into(this));Ct.test(t[0])||O.error(`Invalid nick - /${e} nick`).into(this);const i=t[0].toLowerCase(),n=s.indexOf(i);switch(e){case"UNHIGHLIGHT":-1!==n&&s.splice(n,1);break;default:case"HIGHLIGHT":-1===n&&s.push(i)}O.info("HIGHLIGHT"===e.toUpperCase()?`Highlighting ${i}`:`No longer highlighting ${i}}`).into(this),this.settings.set("highlightnicks",s),this.applySettings()}cmdTIMESTAMPFORMAT(t){if(0===t.length)O.info(`Current format: ${this.settings.get("timestampformat")} (the default is 'HH:mm', for more info: http://momentjs.com/docs/#/displaying/format/)`).into(this);else{const e=t.slice(1,t.length);/^[a-z :.,-\\*]+$/i.test(e)?(O.info(`New format: ${this.settings.get("timestampformat")}`).into(this),this.settings.set("timestampformat",e),this.applySettings()):O.error("Invalid format, see: http://momentjs.com/docs/#/displaying/format/").into(this)}}cmdBROADCAST(t){this.source.send("BROADCAST",{data:t.join(" ")})}cmdWHISPER(t){if(t[0]&&Ct.test(t[0]))if(t[0].toLowerCase()===this.user.username.toLowerCase())O.error("Cannot send a message to yourself").into(this);else{const e=t.slice(1,t.length).join(" ");this.replyusername=t[0],this.source.send("PRIVMSG",{nick:t[0],data:e})}else O.error("Invalid nick - /msg nick message").into(this)}cmdCONNECT(t){this.source.connect(t[0])}cmdTAG(t){if(0===t.length){if(this.taggednicks.size>0){let t="Tagged nicks\n\n";this.taggednicks.forEach((e,s)=>{let i=this.taggednotes.has(s)?this.taggednotes.get(s):"";t+=`    ${s} (${e}) ${i}`+"\n"}),O.info(t+"\n").into(this)}else O.info("No tagged nicks.").into(this);return void O.info(`Usage. /tag <nick> [<color>, <note>]\n(Available colors: ${It.join(", ")})`).into(this)}if(!Ct.test(t[0]))return void O.error("Invalid nick - /tag <nick> [<color>, <note>]").into(this);const e=t[0].toLowerCase();if(e===this.user.username.toLowerCase())return void O.error("Cannot tag yourself").into(this);if(!this.users.has(e))return void O.error("User must be present in chat to tag.").into(this);let s="",i="";t[1]?(-1!==It.indexOf(t[1])?(s=t[1],i=t[2]?t.slice(2,t.length).join(" "):""):(s=It[Math.floor(Math.random()*It.length)],i=t[1]?t.slice(1,t.length).join(" "):""),i.length>100&&(i=i.substr(0,100))):s=It[Math.floor(Math.random()*It.length)],this.mainwindow.getlines(`.msg-user[data-username="${e}"]`).removeClass(vt.removeClasses("msg-tagged")).addClass(`msg-tagged msg-tagged-${s}`).find(".user").attr("title",i),this.taggednicks.set(e,s),this.taggednotes.set(e,i),this.settings.set("taggednicks",[...this.taggednicks]),this.settings.set("taggednotes",[...this.taggednotes]),this.applySettings(),O.info(`Tagged ${t[0]} as ${s}`).into(this)}cmdUNTAG(t){if(0===t.length){if(this.taggednicks.size>0){let t="Tagged nicks\n\n";this.taggednicks.forEach((e,s)=>{let i=this.taggednotes.has(s)?this.taggednotes.get(s):"";t+=`    ${s} (${e}) ${i}`+"\n"}),O.info(t+"\n").into(this)}else O.info("No tagged nicks.").into(this);return void O.info("Usage. /untag <nick>").into(this)}if(!Ct.test(t[0]))return void O.error("Invalid nick - /untag <nick> [<color>, <note>]").into(this);const e=t[0].toLowerCase();this.mainwindow.getlines(`.msg-chat[data-username="${e}"]`).removeClass(vt.removeClasses("msg-tagged")).find(".user").removeAttr("title"),this.taggednicks.delete(e),this.taggednotes.delete(e),this.settings.set("taggednicks",[...this.taggednicks]),this.settings.set("taggednotes",[...this.taggednotes]),this.applySettings(),O.info(`Un-tagged ${e}`).into(this)}cmdBANINFO(){O.info("Loading ban info ...").into(this),Object(i.a)(`${this.config.api.base}/api/chat/me/ban`,{credentials:"include"}).then(t=>t.json()).then(t=>{if("bannotfound"===t)return void O.info("You have no active bans. Thank you.").into(this);const e=Object.assign({},Ft,t),s=e.username?e.username:"Chat",i=m()(e.starttimestamp).format(r.FULL);if(e.endtimestamp){const t=m()(e.endtimestamp).calendar();O.info(`Temporary ban by ${s} started on ${i} and ending by ${t}`).into(this)}else O.info(`Permanent ban by ${s} started on ${i}.`).into(this);if(e.reason){const t=O.message(e.reason,new p(s),e.starttimestamp);t.historical=!0,t.into(this)}O.info("End of ban information").into(this)}).catch(()=>O.error("Error loading ban info. Check your profile.").into(this))}cmdEXIT(){const t=this.getActiveWindow();t!==this.mainwindow&&(this.windowToFront(this.mainwindow.name),this.removeWindow(t.name))}cmdREPLY(){const t=this.getActiveWindow(),e=t.lastmessage&&t.lastmessage.user?t.lastmessage.user.username:null,s=null!==this.replyusername&&""!==this.replyusername?this.replyusername:e;null===s?O.info("No-one to reply to :(").into(this):this.input.val(`/w ${s} `),this.input.focus()}cmdSTALK(t){if(t[0]&&/^\d+$/.test(t[0])&&(t[1]=t[0],t[0]=this.user.username),!t[0]||!Ct.test(t[0].toLowerCase()))return void O.error("Invalid nick - /stalk <nick> <limit>").into(this);if(this.busystalk)return void O.error("Still busy stalking").into(this);if(this.nextallowedstalk&&this.nextallowedstalk.isAfter(new Date))return void O.error(`Next allowed stalk ${this.nextallowedstalk.fromNow()}`).into(this);this.busystalk=!0;const e=t[1]?parseInt(t[1]):3;O.info(`Getting messages for ${[t[0]]} ...`).into(this),Object(i.a)(`${this.config.api.base}/api/chat/stalk?username=${encodeURIComponent(t[0])}&limit=${e}`,{credentials:"include"}).then(t=>t.json()).then(e=>{if(e&&e.lines&&0!==e.lines.length){const s=m.a.utc(1e3*e.lines[e.lines.length-1].timestamp).local().format(r.FULL);O.info(`Stalked ${t[0]} last seen ${s}`).into(this),e.lines.forEach(t=>O.historical(t.text,new p(e.nick),1e3*t.timestamp).into(this)),O.info(`End (https://dgg.overrustlelogs.net/${t[0]})`).into(this)}else O.info(`No messages for ${t[0]}`).into(this)}).catch(()=>O.error(`No messages for ${t[0]} received. Try again later`).into(this)).then(()=>{this.nextallowedstalk=m()().add(10,"seconds"),this.busystalk=!1})}cmdMENTIONS(t){if(t[0]&&/^\d+$/.test(t[0])&&(t[1]=t[0],t[0]=this.user.username),t[0]||(t[0]=this.user.username),!t[0]||!Ct.test(t[0].toLowerCase()))return void O.error("Invalid nick - /mentions <nick> <limit>").into(this);if(this.busymentions)return void O.error("Still busy getting mentions").into(this);if(this.nextallowedmentions&&this.nextallowedmentions.isAfter(new Date))return void O.error(`Next allowed mentions ${this.nextallowedmentions.fromNow()}`).into(this);this.busymentions=!0;const e=t[1]?parseInt(t[1]):3;O.info(`Getting mentions for ${[t[0]]} ...`).into(this),Object(i.a)(`${this.config.api.base}/api/chat/mentions?username=${encodeURIComponent(t[0])}&limit=${e}`,{credentials:"include"}).then(t=>t.json()).then(e=>{if(e&&0!==e.length){const s=m.a.utc(1e3*e[e.length-1].date).local().format(r.FULL);O.info(`Mentions for ${t[0]} last seen ${s}`).into(this),e.forEach(t=>O.historical(t.text,new p(t.nick),1e3*t.date).into(this)),O.info(`End (https://dgg.overrustlelogs.net/mentions/${t[0]})`).into(this)}else O.info(`No mentions for ${t[0]}`).into(this)}).catch(()=>O.error(`No mentions for ${t[0]} received. Try again later`).into(this)).then(()=>{this.nextallowedmentions=m()().add(10,"seconds"),this.busymentions=!1})}openConversation(t){const e=t.toLowerCase(),s=this.whispers.get(e);s&&(U.closeMenus(this),this.windows.has(e)||this.createConversation(s,t,e),this.windowToFront(e),this.menus.get("whisper-users").redraw(),this.input.focus())}createConversation(t,e,s){const n=this.users.get(s)||new p(e),o=new it(s,"chat-output-whisper",n.nick).into(this);let a=!0;o.on("show",()=>{a&&(a=!1,O.info(`Messages between you and ${e}`).into(this,o),Object(i.a)(`${this.config.api.base}/api/messages/usr/${encodeURIComponent(n.nick)}/inbox`,{credentials:"include"}).then(t=>t.json()).then(t=>{if(t.length>0){const e=m()(t[0].timestamp).format(r.FULL);O.info(`Last message ${e}`).into(this,o),t.reverse().forEach(t=>{const e=this.users.get(t.from.toLowerCase())||new p(t.from);O.historical(t.message,e,t.timestamp).into(this,o)})}}).catch(()=>O.error("Failed to load messages :(").into(this,o))),t.unread=0,t.open=!0}),o.on("hide",()=>t.open=!1)}static removeSlashCmdFromText(t){return t.replace(At,"").trim()}static extractNicks(t){let e,s=new Set;for(;e=pt.exec(t);)s.add(e[1]);return[...s]}static removeClasses(t){return function(e,s){return(s.match(new RegExp(`\\b${t}(?:[A-z-]+)?\\b`,"g"))||[]).join(" ")}}static isArraysEqual(t,e){return(!t||!e)&&(t.length!==e.length||t.sort().toString()!==e.sort().toString())}static showNotification(t,e,s,i=!1){if("granted"===n.permission){const o=new n(t,{body:e,tag:`dgg${s}`,icon:"/notifyicon.png?v2",dir:"auto"});i&&setTimeout(()=>o.close(),8e3)}}static makeSafeForRegex(t){return t.trim().replace(Et,"\\$&")}static parseTimeInterval(t){let e=0,s={s:1e9,sec:1e9,secs:1e9,second:1e9,seconds:1e9,m:6e10,min:6e10,mins:6e10,minute:6e10,minutes:6e10,h:36e11,hr:36e11,hrs:36e11,hour:36e11,hours:36e11,d:864e11,day:864e11,days:864e11};return t.replace(gt,(function(t,i,n){i*=n&&s[n.toLowerCase()]||s.s,e+=+i})),e}static loadCss(t){const e=document.createElement("link");return e.href=t,e.type="text/css",e.rel="stylesheet",e.media="screen",document.getElementsByTagName("head")[0].appendChild(e),e}static reqParam(t,e){t=t.replace(/[\[\]]/g,"\\$&"),e=location||window.location.href||null;const s=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return s&&s[2]?decodeURIComponent(s[2].replace(/\+/g," ")):null}static extractHostname(t){let e=t.indexOf("://")>-1?t.split("/")[2]:t.split("/")[0];return e=e.split(":")[0],e=e.split("?")[0],e}}var Bt=e.a=vt},3:function(t,e,s){"use strict";e.a={MODERATOR:"moderator",PROTECTED:"protected",SUBSCRIBER:"subscriber",TWITCHSUB:"flair9",ADMIN:"admin",BROADCASTER:"flair12",VIP:"vip",BOT:"bot",BOT2:"flair11"}},47:function(t,e,s){}}]);